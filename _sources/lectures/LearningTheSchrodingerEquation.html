

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Solving the Time Dependent Schrodinger Equation with Physics-Informed Deep Learning &#8212; PHYS 498 MLP</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_sources/lectures/LearningTheSchrodingerEquation';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Introduction to Symbolic Regression" href="SymbolicRegression.html" />
    <link rel="prev" title="Physics Informed Neural Networks" href="PhysicsInformedNeuralNetworks.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="PHYS 498 MLP - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="PHYS 498 MLP - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    <span style="color:Blue">Machine Learning for Physics</span>
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week_01.html"><span style="color: blue;"><b>Introduction to Data Science</b></span></a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference external" href="https://docs.google.com/presentation/d/1cQJycGyQ07qSOoeskr6GjjTD3byIkxDbdi228NRgFeU/edit?usp=sharing">Slides</a></li>
<li class="toctree-l2"><a class="reference internal" href="JupyterNumpy.html">Jupyter Notebooks and Numerical Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="Pandas.html">Handling Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="Visualization.html">Visualizing Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="Clustering.html">Finding Structure in Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="Dimensionality.html">Measuring and Reducing Dimensionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="Nonlinear.html">Adapting Linear Methods to Non-Linear Data and Kernel Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../homework/Homework_01.html">Homework 01: Introduction to Data Science</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week_02.html"><span style="color: blue;"><b>Probability Theory and Density Estimation</b></span></a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference external" href="https://docs.google.com/presentation/d/1o9tM9ppKZWIa9B3WIHy5JDF4myR5NkO02W6WAlyiTSg/edit?usp=sharing">Slides</a></li>
<li class="toctree-l2"><a class="reference internal" href="ProbabilityTheory.html">Probability Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="ProbabilityDistributions.html">Important Probability Distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="DensityEstimation.html">Estimating Probability Density from Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../homework/Homework_02.html">Homework 02: Probability Theory and Density Estimation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week_03.html"><span style="color: blue;"><b>Bayesian Statistics I</b></span></a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference external" href="https://docs.google.com/presentation/d/1h2SMuH-Z5a_OE6UMDbFjysEiL2NmYT1tGww6VF5jzsA/edit?usp=sharing">Slides</a></li>
<li class="toctree-l2"><a class="reference internal" href="Statistics.html">Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="BayesianInference.html">Bayesian Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="MarkovChainMonteCarlo.html">Markov Chain Monte Carlo in Practice</a></li>
<li class="toctree-l2"><a class="reference internal" href="MarkovChains.html">Stochastic Processes and Markov-Chain Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../homework/Homework_03.html">Homework 03: Bayesian Statistics and Markov Chains</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week_04.html"><span style="color: blue;"><b>Bayesian Statistics II</b></span></a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference external" href="https://docs.google.com/presentation/d/18bft9_CiBLjjBy0MHvT_vN7E95kfakvhm_7d7WKHXyY/edit?usp=sharing">Slides</a></li>
<li class="toctree-l2"><a class="reference internal" href="ModelSelection.html">Bayesian Model Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="VariationalInference.html">Variational Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="Optimization.html">Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="CrossValidation.html">Cross Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../homework/Homework_04.html">Homework 04: Metropolis-Hastings and Cross Validation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week_05.html"><span style="color: blue;"><b>Introduction to Artificial Intelligence</b></span></a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference external" href="https://docs.google.com/presentation/d/1by3-6jDEorKi7_WEr6PTMfEBE8f4xrS94fNdtSuATVg/edit?usp=sharing">Slides</a></li>
<li class="toctree-l2"><a class="reference internal" href="SupervisedLearning.html">Supervised Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="Learning.html">Artificial Intelligence and Machine Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="ArtificialNeuralNetworks.html">Artificial Neural Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="DeepLearning.html">Deep Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../homework/Homework_05.html">Homework 05: Artificial Neural Networks</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week_06.html"><span style="color: blue;"><b>Convolutional and Recurrent Neural Networks</b></span></a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference external" href="https://docs.google.com/presentation/d/1cDFVtEVGLaWd4256OShSb3Roto0x4y4GwG6LkhVozg0/edit?usp=sharing">Slides</a></li>
<li class="toctree-l2"><a class="reference internal" href="ConvolutionalRecurrentNeuralNetworks.html">Convolutional and Recurrent Neural Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../homework/Homework_06.html">Homework 06: Forecasting Projectile Motion with Recurrent Neural Networks</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week_07.html"><span style="color: blue;"><b>Geometric Deep Learning and Graph Neural Networks</b></span></a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference external" href="https://docs.google.com/presentation/d/1jK61M3QGH7bxFU7TMBm16G3YDb-7HOFtgNdqlj3Gs38/edit?usp=sharing">Slides</a></li>
<li class="toctree-l2"><a class="reference internal" href="GraphNeuralNetworks.html">Geometric Deep Learning and Graph Neural Networks</a></li>





</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week_08.html"><span style="color: blue;"><b>Attention Mechanism and Transformers</b></span></a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference external" href="https://docs.google.com/presentation/d/1ZHuK7TopASFSoyUoELKeCGT8bullhtSLcEkrp4ZueGg/edit?usp=sharing">Slides</a></li>
<li class="toctree-l2"><a class="reference internal" href="Attention.html">Attention</a></li>
<li class="toctree-l2"><a class="reference internal" href="Transformers.html">Transformers</a></li>
<li class="toctree-l2"><a class="reference internal" href="VisionTransformer.html">Vision Transformer</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Project_01.html"><span style="color: blue;"><b>Project 01</b></span></a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/Project_01_HiggsTauTau.html">Higgs Boson Decaying to Tau Leptons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/Project_01_ExoticParticles.html">Searching for Exotic Particles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/Project_01_GalaxyZoo.html">Galaxy Zoo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/Project_01_NuclearGeometryQGP.html">Nuclear Geometry and Characterization of the Quark Gluon Plasma</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/Project_01_AberratedImages.html">Aberrated Image Recovery of Ultracold Atoms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/Project_01_DarkEnergySurvey.html">Dark Energy Survey</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/Project_01_GravitationalWaves.html">Detection of Gravitational Waves</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week_09.html"><span style="color: blue;"><b>Generative Modeling and Simulation-Based Inference</b></span></a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference external" href="https://docs.google.com/presentation/d/1h13YeUjtTU_WHLxghxFBBQJO3uRr1GtsIyO4DVZviJo/edit?usp=sharing">Slides</a></li>
<li class="toctree-l2"><a class="reference internal" href="GenerativeModeling.html">Generative Modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="AutoEncoders.html">Autoencoders</a></li>
<li class="toctree-l2"><a class="reference internal" href="VariationalAutoEncoders.html">Variational AutoEncoders</a></li>
<li class="toctree-l2"><a class="reference internal" href="GenerativeAdversarialNetworks.html">Generative Adversarial Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="Diffusion.html">Diffusion Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="NormalizingFlows.html">Normalizing Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="SimulationBasedInference.html">Simulation Based Inference</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week_10.html"><span style="color: blue;"><b>Reinforcement Learning</b></span></a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference external" href="https://docs.google.com/presentation/d/1EsW71u3hdNdXyhlDfkmOX__9c4wJZUee_pjlsmlv_Vg/edit?usp=sharing">Slides</a></li>
<li class="toctree-l2"><a class="reference internal" href="ReinforcementLearning.html">Reinforcement Learning</a></li>




<li class="toctree-l2"><a class="reference internal" href="../homework/Homework_07.html">Homework 07: Reinforcement Learning: Implementing a Deep Q-Network</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week_11.html"><span style="color: blue;"><b>AI Explainablility and Uncertainty Quantification</b></span></a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference external" href="https://docs.google.com/presentation/d/1ydzY7IEYzALTR6ez5gvwwKDduf_7wUtZddq0SUSuvI0/edit?usp=sharing">Slides</a></li>
<li class="toctree-l2"><a class="reference internal" href="AIExplainabilityUncertaintyQuantification.html">AI Explainability and Uncertainty Quantification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../homework/Homework_08.html">Homework 08: Detecting Distribution Shift on MNIST using Bayesian Neural Networks</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week_12.html"><span style="color: blue;"><b>Unsupervised Learning and Anomaly Detection</b></span></a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference external" href="https://docs.google.com/presentation/d/1ydzY7IEYzALTR6ez5gvwwKDduf_7wUtZddq0SUSuvI0/edit?usp=sharing">Slides</a></li>
<li class="toctree-l2"><a class="reference internal" href="UnsupervisedLearningAnomalyDetection.html">Unsupervised Learning and Anomaly Detection</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../Week_13.html"><span style="color: blue;"><b>Physics Informed Neural Networks</b></span></a><input checked="" class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference external" href="https://docs.google.com/presentation/d/1C-Z8b6WP5rE8yohZQdSxyH8O_bHIbllq97QhEJYyh0w/edit?usp=sharing">Slides</a></li>
<li class="toctree-l2"><a class="reference internal" href="PhysicsInformedNeuralNetworks.html">Physics Informed Neural Networks</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Solving the Time Dependent Schrodinger Equation with Physics-Informed Deep Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="SymbolicRegression.html">Introduction to Symbolic Regression</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Project_02.html"><span style="color: blue;"><b>Project 02</b></span></a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../projects/Project_02_AnisotropyQGP.html">Anisotropy in the Quark Gluon Plasma</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects/Project_02_AberratedImages.html">Aberrated Image Recovery of Ultracold Atoms</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week_14.html"><span style="color: blue;"><b>Learning from the Machines</b></span></a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference external" href="https://docs.google.com/presentation/d/1hkfaU7JVy1f5S8jURZvTY67KRzP7I8zGRf4Zku_bpM4/edit?usp=sharing">Slides</a></li>
<li class="toctree-l2"><a class="reference internal" href="LearningPhysicsMachines.html">Learning Physics from the Machines</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week_15.html"><span style="color: blue;"><b>Future of AI and Physics: What Lies Ahead?</b></span></a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference external" href="https://docs.google.com/presentation/d/1eB1qCn5J07D5he_DCpkBiKjbVjdI6OexUzMQ351GCaI/edit?usp=sharing">Slides</a></li>
<li class="toctree-l2"><a class="reference internal" href="LookingForward.html">Future of AI and Physics: What Lies Ahead?</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/illinois-mlp/MachineLearningForPhysics/blob/main/_sources/lectures/LearningTheSchrodingerEquation.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/illinois-mlp/MachineLearningForPhysics" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/_sources/lectures/LearningTheSchrodingerEquation.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Solving the Time Dependent Schrodinger Equation with Physics-Informed Deep Learning</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-orange-helper-functions-span"><span style="color:Orange">Helper Functions</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-orange-brief-overview-span"><span style="color:Orange">Brief Overview</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-lightgreen-mathematical-formulation-span"><span style="color:LightGreen">Mathematical Formulation</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-lightgreen-physical-interpretation-span"><span style="color:LightGreen">Physical Interpretation</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-orange-infinite-square-well-span"><span style="color:Orange">Infinite Square Well</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-lightgreen-analytic-solution-span"><span style="color:LightGreen">Analytic Solution</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-lightgreen-setting-up-tise-solver-span"><span style="color:LightGreen">Setting up TISE Solver</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-orange-quantum-harmonic-oscillator-time-independent-span"><span style="color:Orange">Quantum Harmonic Oscillator (Time Independent)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"><span style="color:LightGreen">Analytic Solution</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-orange-quantum-harmonic-oscillator-time-dependent-span"><span style="color:Orange">Quantum Harmonic Oscillator (Time Dependent)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-lightgreen-base-case-span-psi-0-1-x-t"><span style="color:LightGreen">Base case:</span> <span class="math notranslate nohighlight">\(\psi_{0,1}(x,t)\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-lightgreen-fully-connected-neural-network-span"><span style="color:LightGreen">Fully Connected Neural Network</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-lightgreen-physics-informed-neural-network"><span style="color:LightGreen">Physics-Informed Neural Network</span></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-orange-training-considerations-span"><span style="color:Orange">Training Considerations</span></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-violet-architecture-span"><span style="color:Violet">Architecture</span></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-violet-collection-points-span"><span style="color:Violet">Collection Points</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-orange-higher-energy-states-span"><span style="color:Orange">Higher Energy States</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-orange-some-project-ideas-span"><span style="color:Orange">Some Project Ideas</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-orange-acknowledgments-span"><span style="color:Orange">Acknowledgments</span></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="solving-the-time-dependent-schrodinger-equation-with-physics-informed-deep-learning">
<h1>Solving the Time Dependent Schrodinger Equation with Physics-Informed Deep Learning<a class="headerlink" href="#solving-the-time-dependent-schrodinger-equation-with-physics-informed-deep-learning" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpl_toolkits.axes_grid1</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.lines</span><span class="w"> </span><span class="kn">import</span> <span class="n">Line2D</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.image</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">img</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn.functional</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">F</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">torch.optim</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">optim</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">torch.utils.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">DataLoader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torchvision</span><span class="w"> </span><span class="kn">import</span> <span class="n">transforms</span><span class="p">,</span> <span class="n">utils</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">interact</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">widgets</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="span-style-color-orange-helper-functions-span">
<h2><span style="color:Orange">Helper Functions</span><a class="headerlink" href="#span-style-color-orange-helper-functions-span" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">viz_colour_rgb</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;col&#39;</span><span class="p">]</span>
    
    <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">w</span>
    <span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">c</span>

   
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># span the whole figure</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

    <span class="c1"># Rotate the tick labels and set their alignment.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
             <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">)</span>


    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">,</span> <span class="n">labelleft</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">,</span>
                    <span class="n">labelbottom</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
 
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;r = </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">:</span><span class="s2">.2</span><span class="si">}</span><span class="s2">, g = </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">:</span><span class="s2">.2</span><span class="si">}</span><span class="s2">, b = </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="si">:</span><span class="s2">.2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">viz_colour_predicted_rgb</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Input RGB:&quot;</span><span class="p">)</span>
    <span class="n">viz_colour_rgb</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Output Prediction RGB:&quot;</span><span class="p">)</span>
    <span class="n">viz_colour_rgb</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;##############################&quot;</span><span class="p">)</span>

<span class="n">rgb_scale</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">cmyk_scale</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="k">def</span><span class="w"> </span><span class="nf">rgb_to_cmyk</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
    <span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">col</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">g</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="c1"># black</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cmyk_scale</span>

    <span class="c1"># rgb [0,1] -&gt; cmy [0,1]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">r</span> 
    <span class="n">m</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">g</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">b</span>

    <span class="c1"># extract out k [0,1]</span>
    <span class="n">min_cmy</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">min_cmy</span><span class="p">)</span> 
    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">min_cmy</span><span class="p">)</span> 
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">min_cmy</span><span class="p">)</span> 
    <span class="n">k</span> <span class="o">=</span> <span class="n">min_cmy</span>

    <span class="c1"># rescale to the range [0,cmyk_scale]</span>
    <span class="k">return</span> <span class="n">c</span><span class="o">*</span><span class="n">cmyk_scale</span><span class="p">,</span> <span class="n">m</span><span class="o">*</span><span class="n">cmyk_scale</span><span class="p">,</span> <span class="n">y</span><span class="o">*</span><span class="n">cmyk_scale</span><span class="p">,</span> <span class="n">k</span><span class="o">*</span><span class="n">cmyk_scale</span>

<span class="k">def</span><span class="w"> </span><span class="nf">cmyk_to_rgb</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">k</span> <span class="o">=</span> <span class="n">col</span>
    <span class="n">r</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="n">k</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="n">k</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="n">k</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span>

<span class="k">def</span><span class="w"> </span><span class="nf">viz_colour_cmyk</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;col&#39;</span><span class="p">]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    
    <span class="n">cyan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>
    <span class="n">magenta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>
    <span class="n">yellow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="n">cyan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">magenta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">yellow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    
    
    <span class="n">rgb_c</span> <span class="o">=</span> <span class="n">cmyk_to_rgb</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">cb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">cmyk_to_rgb</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">cyan</span><span class="p">)</span>
    <span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">cmyk_to_rgb</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">magenta</span><span class="p">)</span>
    <span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">cmyk_to_rgb</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">yellow</span><span class="p">)</span>
    <span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">w</span>
    <span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">w</span>
    <span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">rgb_c</span>

   
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># span the whole figure</span>
    <span class="c1">#ax.set_axis_off()</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

    <span class="c1"># Rotate the tick labels and set their alignment.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
             <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">)</span>


    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">,</span> <span class="n">labelleft</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">,</span>
                    <span class="n">labelbottom</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
 
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;c = </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">:</span><span class="s2">.2</span><span class="si">}</span><span class="s2">, m = </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">:</span><span class="s2">.2</span><span class="si">}</span><span class="s2">, y = </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="si">:</span><span class="s2">.2</span><span class="si">}</span><span class="s2">, k = </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="si">:</span><span class="s2">.2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">viz_colour_predicted_cmyk</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Input RGB:&quot;</span><span class="p">)</span>
    <span class="n">viz_colour_rgb</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Output Prediction:&quot;</span><span class="p">)</span>
    <span class="n">viz_colour_cmyk</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;##############################&quot;</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ColourDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">,</span> <span class="n">output_data</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">input_data</span> <span class="o">=</span> <span class="n">input_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_data</span> <span class="o">=</span> <span class="n">output_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        
        <span class="n">sample</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input_data</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_data</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span>


        <span class="k">return</span> <span class="n">sample</span>
<span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_plots_norm_colorbar</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">n_x</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">plot_fname</span><span class="p">):</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Predicted&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="s2">&quot;Abs Err&quot;</span><span class="p">]</span>
    
    <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">dens</span> <span class="o">=</span> <span class="n">get_density</span><span class="p">(</span><span class="n">y_true</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="n">u_pred</span><span class="p">,</span> <span class="n">v_pred</span><span class="p">,</span> <span class="n">dens_pred</span> <span class="o">=</span> <span class="n">get_density</span><span class="p">(</span><span class="n">y_pred</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    
    

    <span class="n">plot_name</span> <span class="o">=</span> <span class="s1">&#39;TD SE Results&#39;</span> <span class="c1">#remove &#39;network_checkpoint_&#39;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    
    <span class="n">mse_u</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">mse_v</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">show_cb</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
    
    <span class="n">x_min</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">x_max</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">t_min</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">t_max</span> <span class="o">=</span> <span class="mi">0</span>
    
    
    <span class="n">u_max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">99.</span>
    <span class="n">u_min</span> <span class="o">=</span> <span class="mf">99.</span>
    <span class="n">v_max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">99.</span>
    <span class="n">v_min</span> <span class="o">=</span> <span class="mf">99.</span>
    <span class="n">d_max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">99.</span>
    <span class="n">d_min</span> <span class="o">=</span> <span class="mf">99.</span>
    
    <span class="n">u_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">u</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">u_pred</span><span class="p">)))</span>
    <span class="n">u_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">u</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">u_pred</span><span class="p">)))</span>
    <span class="n">v_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v_pred</span><span class="p">)))</span>
    <span class="n">v_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">v</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">v_pred</span><span class="p">)))</span>
    <span class="n">d_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dens</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dens_pred</span><span class="p">)))</span>
    <span class="n">d_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dens</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dens_pred</span><span class="p">)))</span>
        
    <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span> <span class="n">x_dom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span><span class="n">t_dom</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    
    <span class="n">u_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_x</span><span class="p">,</span><span class="n">n_t</span><span class="p">))</span>
    <span class="n">v_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">((</span><span class="n">n_x</span><span class="p">,</span><span class="n">n_t</span><span class="p">))</span>
    <span class="n">d_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">((</span><span class="n">n_x</span><span class="p">,</span><span class="n">n_t</span><span class="p">))</span>
    
    <span class="n">reshape_to_grid</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>  <span class="p">(</span><span class="n">n_x</span><span class="p">,</span> <span class="n">n_t</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">u_plot</span> <span class="o">=</span> <span class="n">reshape_to_grid</span><span class="p">(</span><span class="n">u_pred</span><span class="p">)</span>
            <span class="n">v_plot</span> <span class="o">=</span> <span class="n">reshape_to_grid</span><span class="p">(</span><span class="n">v_pred</span><span class="p">)</span>
            <span class="n">d_plot</span> <span class="o">=</span> <span class="n">reshape_to_grid</span><span class="p">(</span><span class="n">dens_pred</span><span class="p">)</span>
            <span class="n">show_cb</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">u_plot</span> <span class="o">=</span> <span class="n">reshape_to_grid</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
            <span class="n">v_plot</span> <span class="o">=</span> <span class="n">reshape_to_grid</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">d_plot</span> <span class="o">=</span> <span class="n">reshape_to_grid</span><span class="p">(</span><span class="n">dens</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">u_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">reshape_to_grid</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">u_pred</span><span class="p">))</span>
            <span class="n">v_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">reshape_to_grid</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">v_pred</span><span class="p">))</span>
            <span class="n">d_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">reshape_to_grid</span><span class="p">(</span><span class="n">dens_pred</span> <span class="o">-</span> <span class="n">dens</span><span class="p">))</span>
            <span class="n">show_cb</span> <span class="o">=</span> <span class="kc">True</span>


        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ims</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">u_plot</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">u_min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">u_max</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> Re($\psi$)&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_cb</span><span class="p">:</span>
            <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax1</span><span class="p">)</span>
            <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">u_min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">u_max</span><span class="p">)</span>
            <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
            <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
            
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> Im($\psi$)&quot;</span><span class="p">)</span>
        <span class="n">ims</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">v_plot</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">v_min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">v_max</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_cb</span><span class="p">:</span>
            <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax1</span><span class="p">)</span>
            <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">v_min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">v_max</span><span class="p">)</span>
            <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
            <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
            
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> $|\psi|^2$&quot;</span><span class="p">)</span>
        <span class="n">ims</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">d_plot</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">d_min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">d_max</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_cb</span><span class="p">:</span>
            <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax1</span><span class="p">)</span>
            <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">d_min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">d_max</span><span class="p">)</span>
            <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
            <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">mse_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">u_plot</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">mse_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v_plot</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> finished&quot;</span><span class="p">)</span>
            
    <span class="n">plot_title</span> <span class="o">=</span> <span class="n">plot_name</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plot_title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mf">0.92</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./tmp_data/</span><span class="si">{</span><span class="n">plot_fname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mse: u: </span><span class="si">{</span><span class="n">mse_u</span><span class="si">}</span><span class="s2">, v:</span><span class="si">{</span><span class="n">mse_v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mse_u</span><span class="p">,</span><span class="n">mse_v</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_density</span><span class="p">(</span><span class="n">y_pred</span><span class="p">):</span>
<span class="c1"># Helper function to split data into real, imag, density</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">y_pred</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">y_pred</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dens</span> <span class="o">=</span> <span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="k">return</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">dens</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_waveforms</span><span class="p">(</span><span class="n">analytical_solution_function</span><span class="p">):</span>
    
    <span class="n">L</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">delta_T</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">delta_X</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">x_dom</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">L</span><span class="p">,</span><span class="n">L</span><span class="p">]</span>
    <span class="n">t_dom</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">L</span><span class="p">]</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_dom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delta_X</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_dom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delta_T</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    
    <span class="n">psi_val</span> <span class="o">=</span> <span class="n">analytical_solution_function</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">omega</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">psi_val</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">psi_val</span><span class="p">)</span>
    
    <span class="n">dens</span> <span class="o">=</span> <span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">max_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dens</span><span class="p">)</span><span class="o">+</span><span class="mf">0.02</span>
    
    
    
    <span class="k">for</span> <span class="n">t_step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)):</span>
        <span class="n">curr_u</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="n">t_step</span><span class="p">,:]</span>
        <span class="n">curr_v</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">t_step</span><span class="p">,:]</span>
        <span class="n">curr_d</span> <span class="o">=</span> <span class="n">dens</span><span class="p">[</span><span class="n">t_step</span><span class="p">,:]</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">max_d</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">curr_d</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;x (au)&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Probability Density $|\psi(x)|^2$&#39;</span><span class="p">,</span>
               <span class="n">title</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$|\psi(x)|^2$ at t=</span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="n">t_step</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> au&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tmp_data/waveform/t_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">t_step</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda:0&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="n">torch</span><span class="o">.</span><span class="n">set_default_dtype</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
<span class="c1">#torch.set_default_device(&#39;cuda:0&#39;)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">set_default_device</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>cpu
</pre></div>
</div>
</div>
</div>
</section>
<section id="span-style-color-orange-brief-overview-span">
<h2><span style="color:Orange">Brief Overview</span><a class="headerlink" href="#span-style-color-orange-brief-overview-span" title="Permalink to this heading">#</a></h2>
<p>The Time-Independent Schrödinger Equation is a fundamental equation in quantum mechanics that describes how the quantum state of a physical system changes in space, but not in time. It is derived from the more general Time-Dependent Schrödinger Equation (TDSE) under the assumption that the system is in a steady state, meaning the potential energy within the system does not change with time. The TISE is crucial for understanding the behavior of particles in potential wells, quantum tunneling, and the quantization of energy levels in atoms and molecules.</p>
<section id="span-style-color-lightgreen-mathematical-formulation-span">
<h3><span style="color:LightGreen">Mathematical Formulation</span><a class="headerlink" href="#span-style-color-lightgreen-mathematical-formulation-span" title="Permalink to this heading">#</a></h3>
<p>The Time-Independent Schrödinger Equation can be introduced starting from the fundamental relationship involving the Hamiltonian operator <span class="math notranslate nohighlight">\( \hat{H} \)</span> acting on the wave function <span class="math notranslate nohighlight">\( \psi \)</span>, equating it to the energy <span class="math notranslate nohighlight">\( E \)</span> of the system times the wave function. This is expressed as:</p>
<div class="math notranslate nohighlight">
\[ \Large
\hat{H} \psi = E \psi
\]</div>
<p>The Hamiltonian operator <span class="math notranslate nohighlight">\( \hat{H} \)</span> represents the total energy of the system and is composed of the kinetic energy (<span class="math notranslate nohighlight">\( T \)</span>) and potential energy (<span class="math notranslate nohighlight">\( V \)</span>) operators:</p>
<div class="math notranslate nohighlight">
\[ \Large
\hat{H} = \hat{T} + \hat{V}
\]</div>
<p>where the kinetic energy operator <span class="math notranslate nohighlight">\( \hat{T} \)</span> is given by:</p>
<div class="math notranslate nohighlight">
\[ \Large
\hat{T} = -\frac{\hbar^2}{2m} \nabla^2
\]</div>
<p>and <span class="math notranslate nohighlight">\( \hat{V} \)</span> represents the potential energy operator, which in position space is simply multiplication by the potential energy function <span class="math notranslate nohighlight">\( V(\mathbf{r}) \)</span>:</p>
<div class="math notranslate nohighlight">
\[ \Large
\hat{V} = V(\mathbf{r})
\]</div>
<p>Substituting the expressions for <span class="math notranslate nohighlight">\( \hat{T} \)</span> and <span class="math notranslate nohighlight">\( \hat{V} \)</span> into the Hamiltonian, we obtain the Time-Independent Schrödinger Equation in position space:</p>
<div class="math notranslate nohighlight">
\[ \Large
\left( -\frac{\hbar^2}{2m} \nabla^2 + V(\mathbf{r}) \right) \psi(\mathbf{r}) = E\psi(\mathbf{r})
\]</div>
<p>Here:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\( \hbar \)</span> is the reduced Planck’s constant (<span class="math notranslate nohighlight">\( \hbar = \frac{h}{2\pi} \)</span>),</p></li>
<li><p><span class="math notranslate nohighlight">\( m \)</span> is the mass of the particle,</p></li>
<li><p><span class="math notranslate nohighlight">\( \nabla^2 \)</span> is the Laplacian operator, indicating the second spatial derivatives,</p></li>
<li><p><span class="math notranslate nohighlight">\( \psi(\mathbf{r}) \)</span> is the wave function of the particle, a complex function that provides information about the probability amplitude of the particle’s position,</p></li>
<li><p><span class="math notranslate nohighlight">\( V(\mathbf{r}) \)</span> is the potential energy as a function of position,</p></li>
<li><p><span class="math notranslate nohighlight">\( E \)</span> is the total energy of the system, which is a constant for time-independent systems.</p></li>
</ul>
</section>
<section id="span-style-color-lightgreen-physical-interpretation-span">
<h3><span style="color:LightGreen">Physical Interpretation</span><a class="headerlink" href="#span-style-color-lightgreen-physical-interpretation-span" title="Permalink to this heading">#</a></h3>
<p>The Time-Independent Schrödinger Equation is an eigenvalue equation where the eigenvalues <span class="math notranslate nohighlight">\( E \)</span> correspond to the energy levels of the system, and the eigenfunctions <span class="math notranslate nohighlight">\( \psi(\mathbf{r}) \)</span> represent the stationary states. The probability density of finding the particle at a given position <span class="math notranslate nohighlight">\( \mathbf{r} \)</span> is given by the square modulus of the wave function, <span class="math notranslate nohighlight">\( |\psi(\mathbf{r})|^2 \)</span>.</p>
</section>
</section>
<section id="span-style-color-orange-infinite-square-well-span">
<h2><span style="color:Orange">Infinite Square Well</span><a class="headerlink" href="#span-style-color-orange-infinite-square-well-span" title="Permalink to this heading">#</a></h2>
<p>The infinite square well (or particle in a box) is a fundamental quantum mechanical system that provides profound insights into the quantization of energy. In this model, a particle is confined to a one-dimensional box with infinitely high walls, leading to discrete energy levels. The potential <span class="math notranslate nohighlight">\(V(x)\)</span> can be described as:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \Large
V(x) = \begin{cases}
0, &amp; \text{if } 0 \leq x \leq L\\
\infty, &amp; \text{otherwise}
\end{cases}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(L\)</span> is the width of the well. For the region inside the well (<span class="math notranslate nohighlight">\(0 \leq x \leq L\)</span>), the TISE simplifies to:</p>
<div class="math notranslate nohighlight">
\[ \Large
-\frac{1}{2} \frac{d^2}{dx^2} \psi(x) = E\psi(x)
\]</div>
<section id="span-style-color-lightgreen-analytic-solution-span">
<h3><span style="color:LightGreen">Analytic Solution</span><a class="headerlink" href="#span-style-color-lightgreen-analytic-solution-span" title="Permalink to this heading">#</a></h3>
<p>The boundary conditions dictate that <span class="math notranslate nohighlight">\(\psi(x) = 0\)</span> at <span class="math notranslate nohighlight">\(x = 0\)</span> and <span class="math notranslate nohighlight">\(x = L\)</span>, leading to quantized energy levels. The solutions to the TISE in this case are sinusoidal functions inside the well:</p>
<div class="math notranslate nohighlight">
\[ \Large
\psi_n(x) = \sqrt{\frac{2}{L}} \sin\left(\frac{n\pi x}{L}\right), \quad n = 1, 2, 3, \ldots
\]</div>
<p>The corresponding energy levels are given by:</p>
<div class="math notranslate nohighlight">
\[ \Large
E_n = \frac{n^2\pi^2}{2L^2}, \quad n = 1, 2, 3, \ldots
\]</div>
<p>Let us implement the potential and analytical solution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exercise</span>

<span class="k">def</span><span class="w"> </span><span class="nf">V_infinite_well</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">params</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">analytical_eigenvalues_infinite_well</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># avoiding trivial solution</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">params</span>
    <span class="n">E</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">E</span>

<span class="k">def</span><span class="w"> </span><span class="nf">analytical_eigenfunctions_infinite_well</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># avoiding trivial solution</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">params</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">normalize_wavefunction</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="span-style-color-lightgreen-setting-up-tise-solver-span">
<h3><span style="color:LightGreen">Setting up TISE Solver</span><a class="headerlink" href="#span-style-color-lightgreen-setting-up-tise-solver-span" title="Permalink to this heading">#</a></h3>
<p>We take a short detour to study a simple numerical method to get the derivates. It is called the Finite Difference Method.</p>
<p>We know that first derivative of a function <span class="math notranslate nohighlight">\(f(x)\)</span> at a point <span class="math notranslate nohighlight">\(x\)</span> represents the rate at which <span class="math notranslate nohighlight">\(f(x)\)</span> changes with respect to <span class="math notranslate nohighlight">\(x\)</span>. The first derivative is defined as the limit of the average rate of change of the function as the interval over which the change is measured approaches zero. Mathematically, this is expressed as:</p>
<div class="math notranslate nohighlight">
\[ \Large
f'(x) = \lim_{h \to 0} \frac{f(x+h) - f(x)}{h}
\]</div>
<p>where <span class="math notranslate nohighlight">\(h\)</span> is the difference between the neighboring point <span class="math notranslate nohighlight">\(x+h\)</span> and the point <span class="math notranslate nohighlight">\(x\)</span>, and <span class="math notranslate nohighlight">\(f(x+h) - f(x)\)</span> represents the change in the function’s value over that interval. The expression <span class="math notranslate nohighlight">\(\frac{f(x+h) - f(x)}{h}\)</span> calculates the average rate of change of <span class="math notranslate nohighlight">\(f(x)\)</span> over the interval from <span class="math notranslate nohighlight">\(x\)</span> to <span class="math notranslate nohighlight">\(x+h\)</span>.</p>
<p>The approximation of the first derivative works based on the principle of this definition. In practice, we cannot take the limit as <span class="math notranslate nohighlight">\(h\)</span> goes to zero because that would require infinitesimally small steps, which are not possible to handle with numerical computations. Instead, we choose a small but finite value of <span class="math notranslate nohighlight">\(h\)</span>, which allows us to approximate the instantaneous rate of change (the derivative) by calculating the slope of the secant line that passes through the points <span class="math notranslate nohighlight">\((x, f(x))\)</span> and <span class="math notranslate nohighlight">\((x+h, f(x+h))\)</span>.</p>
<p>So, we have</p>
<div class="math notranslate nohighlight">
\[ \Large
f'(x_i) \approx \frac{f(x_{i+1}) - f(x_i)}{h}
\]</div>
<p>for a finite <span class="math notranslate nohighlight">\(h\)</span>. This formula gives a first-order approximation of the derivative.</p>
<p>Let’s implement this in python for an arbitrary function <code class="docutils literal notranslate"><span class="pre">f</span></code> at grid points <code class="docutils literal notranslate"><span class="pre">x_grid</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exercise: Get the first derivative numerically</span>
<span class="k">def</span><span class="w"> </span><span class="nf">approximate_first_derivative</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x_grid</span><span class="p">):</span>
    <span class="n">dfdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x_grid</span><span class="p">)</span>
    
    <span class="c1"># Compute the spacing based on the input grid</span>
    <span class="c1"># Assuming uniform spacing</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">x_grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Forward difference for all points except the last</span>
    <span class="n">dfdx</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x_grid</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">x_grid</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="n">h</span>
    
    <span class="c1"># This is provided to make sure that the last point is not left out.</span>
    <span class="c1"># Since we don&#39;t have a forward difference for the last point, we&#39;ll use a backward difference.</span>
    <span class="c1"># It is similar to the forward difference, but we use the previous point instead of the next point.</span>
    <span class="n">dfdx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x_grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">x_grid</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span> <span class="o">/</span> <span class="n">h</span>
    
    <span class="k">return</span> <span class="n">dfdx</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_derivative</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="n">x_min</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">x_max</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span>

    <span class="n">dfdx_approx</span> <span class="o">=</span> <span class="n">approximate_first_derivative</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="n">dfdx_exact</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dfdx_approx</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;FDM Derivative&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dfdx_exact</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Analytical Derivative&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;df/dx&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Approximation vs. Analytical Derivative of $f(x) = sin(x)$, h = </span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_derivative</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8cc57fafcffc9541317fb9cac6f50ec94cb78790f05066ea7eedaeb62c0789f8.png" src="../../_images/8cc57fafcffc9541317fb9cac6f50ec94cb78790f05066ea7eedaeb62c0789f8.png" />
</div>
</div>
<p>To approximate the second derivative, we start from the basic first derivative approximations and extend them. The second derivative at a point <span class="math notranslate nohighlight">\(x_i\)</span> can be derived by applying the first derivative approximation twice, leading to:</p>
<div class="math notranslate nohighlight">
\[
f''(x_i) \approx \frac{f'(x_{i+1}) - f'(x_i)}{h}
\]</div>
<p>Exercise: Use the forward difference formula for <span class="math notranslate nohighlight">\(f'(x_{i+1})\)</span> and <span class="math notranslate nohighlight">\(f'(x_i)\)</span> and simplify the above equation to get:</p>
<div class="math notranslate nohighlight">
\[
f''(x_i) \approx \frac{f(x_{i+1}) - 2f(x_i) + f(x_{i-1})}{h^2}
\]</div>
<p>This gives us a second-order accurate approximation of the second derivative.</p>
<p>Notice that x grid is a vector of length <span class="math notranslate nohighlight">\(N+1\)</span>. We can represent this as a matrix multiplication</p>
<div class="math notranslate nohighlight">
\[
F2X = FD2 * f(x)
\]</div>
<p>where f(x) is the vector of legth <span class="math notranslate nohighlight">\(N+1\)</span>, and FD2 is a matrix of shape <span class="math notranslate nohighlight">\(N+1, N+1\)</span> with diagonal elements corresponding to the terms in the finite difference equation you derived above. Let’s implement this in code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exercise</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_fd2_matrix</span><span class="p">(</span><span class="n">x_grid</span><span class="p">,</span> <span class="n">fix_boundary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># Define the matrix</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_grid</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">x_grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Main diagonal values (central differences for the second derivative)</span>
    <span class="n">main_diagonal</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">/</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="c1"># Off diagonal values (one step off the main diagonal)</span>
    <span class="n">off_diagonal</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="c1"># Assemble the tridiagonal matrix</span>
    <span class="n">fd_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">main_diagonal</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">off_diagonal</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">off_diagonal</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># These are for numerical stability. We use higher order terms at the boundaries.</span>
    <span class="k">if</span> <span class="n">fix_boundary</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">fd_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">fd_matrix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The grid is too small to use higher order terms.&quot;</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">fd_matrix</span>
</pre></div>
</div>
</div>
</div>
<p>This is what the matrix looks like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span> <span class="o">=</span> <span class="n">get_fd2_matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[-2.  1.  0.  0.  0.]
 [ 1. -2.  1.  0.  0.]
 [ 0.  1. -2.  1.  0.]
 [ 0.  0.  1. -2.  1.]
 [ 0.  0.  0.  1. -2.]]
</pre></div>
</div>
</div>
</div>
<p>Do you notice the [1, -2, 1] pattern from our derivation?</p>
<p>Now we use this matrix on our test problem sin(x)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_second_derivative</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">show_boundary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fix_boundary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">x_min</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">x_max</span> <span class="o">=</span> <span class="mf">6.28</span>
    <span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">show_boundary</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">fd_matrix</span> <span class="o">=</span> <span class="n">get_fd2_matrix</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fix_boundary</span><span class="o">=</span><span class="n">fix_boundary</span><span class="p">)</span>

    <span class="n">df2dx2_approx</span> <span class="o">=</span> <span class="n">fd_matrix</span> <span class="o">@</span> <span class="n">f</span>


    <span class="n">dfdx_exact</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="c1"># print(f&quot;{k=}, {show_boundary=}&quot;)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">df2dx2_approx</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;FDM Derivative&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">dfdx_exact</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Analytical Derivative&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;df/dx&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Approximation vs. Analytical Derivative of $f(x) = sin(x)$, h = </span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.3</span><span class="si">}</span><span class="s1">, 10^k=</span><span class="si">{</span><span class="mi">10</span><span class="o">**</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_second_derivative</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/52cd2c3f3df614cf0a4d4ba862bcd18b06690a8ae2d506b60adfd016af24e3b8.png" src="../../_images/52cd2c3f3df614cf0a4d4ba862bcd18b06690a8ae2d506b60adfd016af24e3b8.png" />
</div>
</div>
<p>The second derivative in the kinetic energy term can be approximated using the central difference formula:</p>
<div class="math notranslate nohighlight">
\[ \Large
\frac{d^2\psi}{dx^2} \bigg|_{x_i} \approx \frac{\psi(x_{i+1}) - 2\psi(x_i) + \psi(x_{i-1})}{h^2}
\]</div>
<p>Substituting this into the TISE, we get a discrete version:</p>
<div class="math notranslate nohighlight">
\[ \Large
-\frac{1}{2} \frac{\psi(x_{i+1}) - 2\psi(x_i) + \psi(x_{i-1})}{h^2} + V(x_i)\psi(x_i) = E\psi(x_i)
\]</div>
<p>This leads to a system of linear equations that can be represented in matrix form as <span class="math notranslate nohighlight">\(H\vec{\psi} = E\vec{\psi}\)</span>, where <span class="math notranslate nohighlight">\(H\)</span> is a tridiagonal matrix with the diagonal elements given by <span class="math notranslate nohighlight">\(\left(\frac{1}{h^2} + V(x_i)\right)\)</span> and the off-diagonal elements by <span class="math notranslate nohighlight">\(-\frac{1}{2h^2}\)</span>.</p>
<p>Now this eigenvalue problem can be solved by matrix inversion methods that you learnt about in your Linear Algebra course. We will use the built-in <code class="docutils literal notranslate"><span class="pre">np.linalg.eigh</span></code> function to get the eigenvalues and eigenvectors. The function takes a potential function <code class="docutils literal notranslate"><span class="pre">V</span></code> and its <code class="docutils literal notranslate"><span class="pre">params</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Utility: Normalize wavefunction</span>

<span class="k">def</span><span class="w"> </span><span class="nf">normalize_wavefunction</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> <span class="o">*</span> <span class="n">psi</span>
    <span class="n">integral_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapezoid</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">psi</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">integral_density</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exercise: Use the functions we defined to set up a TISE solver</span>
<span class="k">def</span><span class="w"> </span><span class="nf">solve_tise</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">state_n</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="c1"># Discretize the spatial domain</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    
    <span class="c1"># Evaluate the potential energy</span>
    <span class="n">V_x</span> <span class="o">=</span> <span class="n">V</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    
    <span class="c1"># Assemble the Hamiltonian matrix</span>
    <span class="n">T_mat</span> <span class="o">=</span> <span class="n">get_fd2_matrix</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">V_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">V_x</span><span class="p">)</span>

    <span class="n">H_mat</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">T_mat</span> <span class="o">+</span> <span class="n">V_mat</span>
    
    <span class="c1"># Solve the eigenvalue problem</span>
    <span class="n">E</span><span class="p">,</span> <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">H_mat</span><span class="p">)</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">state_n</span><span class="p">]</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[:,</span> <span class="n">state_n</span><span class="p">]</span>
    
    <span class="c1"># Normalize the wavefunction</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="n">normalize_wavefunction</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">psi</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Utility: Plotting the wavefunction</span>
<span class="k">def</span><span class="w"> </span><span class="nf">wavefunction_plotter</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">state_n</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">true_wavefunction_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">true_energy_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sys_name</span><span class="o">=</span><span class="s2">&quot;System&quot;</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">psi</span> <span class="o">=</span> <span class="n">solve_tise</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">state_n</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">true_wavefunction_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">true_energy_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">true_E</span> <span class="o">=</span> <span class="n">true_energy_fn</span><span class="p">(</span><span class="n">state_n</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            <span class="n">true_wfs</span> <span class="o">=</span> <span class="n">true_wavefunction_fn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">state_n</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            
            <span class="c1"># Normalize the wavefunction</span>
            <span class="n">true_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">true_wfs</span><span class="p">)</span> <span class="o">*</span> <span class="n">true_wfs</span>
            <span class="n">integral_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapezoid</span><span class="p">(</span><span class="n">true_density</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">true_wfs</span> <span class="o">=</span> <span class="n">true_wfs</span><span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">integral_density</span><span class="p">)</span>

            
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">7.5</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;E_</span><span class="si">{</span><span class="n">state_n</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">E</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">true_wavefunction_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">true_energy_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">true_wfs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;True E_</span><span class="si">{</span><span class="n">state_n</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">true_E</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">ax1_right</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
    <span class="n">ax1_right</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">V</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;V(x)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">ax1_right</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;V(x)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\psi(x)$&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wavefunction for </span><span class="si">{</span><span class="n">sys_name</span><span class="si">}</span><span class="s1">, state </span><span class="si">{</span><span class="n">state_n</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
    <span class="n">ax1_right</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

    <span class="n">density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> <span class="o">*</span> <span class="n">psi</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Density |$\psi$|^2&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">true_wavefunction_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">true_energy_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>    
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">true_density</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;True Density |$\psi$|^2&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">ax2_right</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
    <span class="n">ax2_right</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">V</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">ax2_right</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;V(x)&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;|$\psi(x)$|^2&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Density for </span><span class="si">{</span><span class="n">sys_name</span><span class="si">}</span><span class="s1">, state </span><span class="si">{</span><span class="n">state_n</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
    <span class="n">ax2_right</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now let us solve it with our numerical solver:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">x_min</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">x_max</span> <span class="o">=</span> <span class="n">L</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1001</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">V_infinite_well</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">L</span>
<span class="n">n_state</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">true_wavefunction_fn</span><span class="o">=</span><span class="n">analytical_eigenfunctions_infinite_well</span>
<span class="n">true_energy_fn</span><span class="o">=</span><span class="n">analytical_eigenvalues_infinite_well</span>
<span class="n">sys_name</span> <span class="o">=</span> <span class="s2">&quot;Infinite Square Well&quot;</span>

<span class="n">wavefunction_plotter</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">n_state</span><span class="p">,</span> <span class="n">true_wavefunction_fn</span><span class="o">=</span><span class="n">true_wavefunction_fn</span><span class="p">,</span> <span class="n">true_energy_fn</span><span class="o">=</span><span class="n">true_energy_fn</span><span class="p">,</span> <span class="n">sys_name</span><span class="o">=</span><span class="n">sys_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8bdb36dab9ed48d56da04e0f62b2867c867cae7f04f456624466150039bb5e25.png" src="../../_images/8bdb36dab9ed48d56da04e0f62b2867c867cae7f04f456624466150039bb5e25.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">state_n_slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;state_n:&#39;</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">interactive_wavefunction_plotter</span><span class="p">(</span><span class="n">state_n</span><span class="p">):</span>
    <span class="n">wavefunction_plotter</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">state_n</span><span class="p">,</span> <span class="n">true_wavefunction_fn</span><span class="p">,</span> <span class="n">true_energy_fn</span><span class="p">,</span> <span class="n">sys_name</span><span class="p">)</span>

<span class="n">interactive_plot</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="n">interactive_wavefunction_plotter</span><span class="p">,</span> <span class="n">state_n</span><span class="o">=</span><span class="n">state_n_slider</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">interactive_plot</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "8dc4b78b52204376af235350e4bb3e09", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
</section>
<section id="span-style-color-orange-quantum-harmonic-oscillator-time-independent-span">
<h2><span style="color:Orange">Quantum Harmonic Oscillator (Time Independent)</span><a class="headerlink" href="#span-style-color-orange-quantum-harmonic-oscillator-time-independent-span" title="Permalink to this heading">#</a></h2>
<p>The quantum harmonic oscillator models a particle moving under a restoring force proportional to its displacement from a equilibrium position, akin to a mass on a spring. The potential energy <span class="math notranslate nohighlight">\(V(x)\)</span> of the QHO is given by:</p>
<div class="math notranslate nohighlight">
\[ \Large
V(x) = \frac{1}{2}\omega^2x^2
\]</div>
<p>where <span class="math notranslate nohighlight">\(m\)</span> is the mass of the particle, <span class="math notranslate nohighlight">\(\omega\)</span> is the angular frequency of the oscillator, and <span class="math notranslate nohighlight">\(x\)</span> is the displacement from equilibrium. In quantum mechanics, the TISE for the harmonic oscillator becomes:</p>
<div class="math notranslate nohighlight">
\[ \Large
\left( -\frac{1}{2} \frac{d^2}{dx^2} + \frac{1}{2}\omega^2x^2 \right) \psi(x) = E\psi(x)
\]</div>
<section id="id1">
<h3><span style="color:LightGreen">Analytic Solution</span><a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<p>The solutions to the quantum harmonic oscillator are Hermite polynomials multiplied by a Gaussian exponential. The energy eigenvalues are given by:</p>
<div class="math notranslate nohighlight">
\[ \Large
E_n = \left(n + \frac{1}{2}\right)\omega, \quad n = 0, 1, 2, \ldots
\]</div>
<p>The analytical solution <span class="math notranslate nohighlight">\(\psi(x,t) \in \mathbb{C}\)</span> is
$<span class="math notranslate nohighlight">\( \Large
\psi_0(x) = \sqrt[4]{\frac{\omega}{\pi}}e^{\left(-\frac{\omega x^2}{2}\right)}
\)</span>$</p>
<p>and</p>
<div class="math notranslate nohighlight">
\[ \Large
\psi_n(x) = \psi_0(x) \frac{1}{\sqrt{2^n n!}}Her_n(\sqrt{\omega}x)
\]</div>
<p>where <span class="math notranslate nohighlight">\(Her_n\)</span> are the Hermite polynomials of degree <span class="math notranslate nohighlight">\(n\)</span>.</p>
<p>Let us implement the potential:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exercise</span>
<span class="k">def</span><span class="w"> </span><span class="nf">V_harmonic_oscillator</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">params</span>
    <span class="n">v</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">omega</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">v</span>
</pre></div>
</div>
</div>
</div>
<p>To implement the analytical solution, we need to first implement Hermite polynomials. We will use the recursive definition:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(H_0(x) = 1\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(H_1(x) = 2x\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(H_{n+1}(x) = 2xH_n(x) - 2nH_{n-1}(x)\)</span> for <span class="math notranslate nohighlight">\(n \geq 1\)</span></p></li>
</ul>
<p>Let’s implement this recursive definition:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exercise: Use the above recursive relation to calculate the Hermite polynomials</span>
<span class="k">def</span><span class="w"> </span><span class="nf">hermite_polynomial</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">hermite_polynomial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">hermite_polynomial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exercise</span>
<span class="k">def</span><span class="w"> </span><span class="nf">analytical_eigenvalues_harmonic_oscillator</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>

    <span class="n">omega</span> <span class="o">=</span> <span class="n">params</span>
    <span class="n">E</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">omega</span>
    <span class="k">return</span> <span class="n">E</span>

<span class="k">def</span><span class="w"> </span><span class="nf">analytical_eigenfunctions_harmonic_oscillator</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    
    <span class="n">omega</span> <span class="o">=</span> <span class="n">params</span>

    <span class="n">psi_0</span> <span class="o">=</span> <span class="p">(</span><span class="n">omega</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">prefactor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">n</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="n">hermite_polynomial_n</span> <span class="o">=</span> <span class="n">hermite_polynomial</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">omega</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="n">prefactor</span> <span class="o">*</span> <span class="n">hermite_polynomial_n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>    
        <span class="k">return</span> <span class="n">normalize_wavefunction</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">normalize_wavefunction</span><span class="p">(</span><span class="n">psi_0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wavefunction_plotter</span><span class="p">(</span><span class="n">V_harmonic_oscillator</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1001</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">analytical_eigenfunctions_harmonic_oscillator</span><span class="p">,</span> <span class="n">analytical_eigenvalues_harmonic_oscillator</span><span class="p">,</span> <span class="s2">&quot;Harmonic Oscillator&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/02bd4cfb06ae630dddd66793df61711283e340d5e13f2bd13b5a6235ebe92c17.png" src="../../_images/02bd4cfb06ae630dddd66793df61711283e340d5e13f2bd13b5a6235ebe92c17.png" />
</div>
</div>
</section>
</section>
<section id="span-style-color-orange-quantum-harmonic-oscillator-time-dependent-span">
<h2><span style="color:Orange">Quantum Harmonic Oscillator (Time Dependent)</span><a class="headerlink" href="#span-style-color-orange-quantum-harmonic-oscillator-time-dependent-span" title="Permalink to this heading">#</a></h2>
<p>Next, we want to solve a Quantum Harmonic Oscillator consisting of a superposition of two states. Note: We will use atomic units unless specified: <span class="math notranslate nohighlight">\(\hbar=m=e=1\)</span>.</p>
<p>The governing equation is time-dependent Schrödinger equation</p>
<div class="math notranslate nohighlight">
\[ \Large
i \frac{\partial \psi(\mathbf{r}, t)}{\partial t}-\hat{H} \psi(\mathbf{r}, t)=0
\]</div>
<p>for a quantum harmonic oscillator consisting of the superposition of two eigenstates <span class="math notranslate nohighlight">\(m,n\)</span>. In the one-dimensional case, the Hamiltonian is</p>
<div class="math notranslate nohighlight">
\[ \Large
\hat{H_x}=-\frac{1}{2}\frac{\partial^{2}}{\partial x^{2}}+\frac{\omega^{2}}{2}x^{2}
\]</div>
<p>The analytical solution <span class="math notranslate nohighlight">\(\psi(x,t) \in \mathbb{C}\)</span> is</p>
<div class="math notranslate nohighlight">
\[ \Large
\phi_0(x) = \sqrt[4]{\frac{\omega}{\pi}}e^{\left(-\frac{\omega x^2}{2}\right)}
\]</div>
<div class="math notranslate nohighlight">
\[ \Large
\phi_1(x) = \phi_0(x) \sqrt{2\omega}x
\]</div>
<p>For higher states,</p>
<div class="math notranslate nohighlight">
\[ \Large
\phi_n(x) = \phi_0(x) \frac{1}{\sqrt{2^n n!}}Her_n(\sqrt{\omega}x)\exp\left(-i E_n t\right)
\]</div>
<p>where <span class="math notranslate nohighlight">\(Her_n(\sqrt{\omega}x)\)</span> is the <span class="math notranslate nohighlight">\(n^{\rm th}\)</span> Hermite polynomial, and phase <span class="math notranslate nohighlight">\(\exp\left(-i E_n t\right)\)</span> where <span class="math notranslate nohighlight">\(E_n = (n+\frac{1}{2})\omega\)</span></p>
<p>The superposition is defined as</p>
<div class="math notranslate nohighlight">
\[ \Large
\psi_{m,n}(x,t) = \frac{1}{\sqrt{2}}\left( e^{\left(-i E_m t\right)}\phi_m(x) + e^{\left(-i E_n t\right)}\phi_n(x)\right)
\]</div>
<section id="span-style-color-lightgreen-base-case-span-psi-0-1-x-t">
<h3><span style="color:LightGreen">Base case:</span> <span class="math notranslate nohighlight">\(\psi_{0,1}(x,t)\)</span><a class="headerlink" href="#span-style-color-lightgreen-base-case-span-psi-0-1-x-t" title="Permalink to this heading">#</a></h3>
<p>Let’s derive the analytical solution for <span class="math notranslate nohighlight">\(\psi_{0,1}(x,t)\)</span>.</p>
<div class="math notranslate nohighlight">
\[ \Large
\psi_{0,1}(x,t) = \frac{1}{\sqrt{2}}\left( e^{\left(-i E_0 t\right)}\phi_m(x) + e^{\left(-i E_1 t\right)}\phi_n(x)\right)
\]</div>
<p>The <span class="math notranslate nohighlight">\(n^{\rm th}\)</span> Physicist’s Hermite Polynomial is defined as:</p>
<div class="math notranslate nohighlight">
\[ \Large
H_{n}(y)=(-1)^{n} e^{y^{2}} \frac{d^{n}}{d y^{n}} e^{-y^{2}}
\]</div>
<p>Now that we have our analytical solution, let’s write some code to compute it for arbitrary values of <span class="math notranslate nohighlight">\(x,t,\omega\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_analytical_solution_base</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">omega</span><span class="p">):</span>
    <span class="c1"># Analytical solution for first two states. X,T are numpy arrays, omega is a float.</span>
    <span class="c1"># Hint: Avoid using for loops, use numpy functions to calculate the wavefunction.</span>
    
    <span class="c1">#Solution:</span>
    <span class="n">phi_0</span> <span class="o">=</span> <span class="p">(</span><span class="n">omega</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">4.</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">X</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">X</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
    <span class="n">phi_1</span> <span class="o">=</span> <span class="n">phi_0</span> <span class="o">*</span>  <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">omega</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">X</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">omega</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">phi_0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span> <span class="mi">3</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">phi_1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">psi</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s define the domain for our problem:</p>
<p>We will restrict our domain to <span class="math notranslate nohighlight">\(\mathbf{x} \in [-\pi,\pi], t \in [0,T]\)</span>, with fixed boundary conditions <span class="math notranslate nohighlight">\(x_0, x_b = 0\)</span> in this notebook.</p>
<p>After you go through the notebook, feel free to play with the code for other domains. Let’s create some data using the function we just wrote.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_data_set</span><span class="p">(</span><span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">delta_X</span><span class="p">,</span> <span class="n">delta_T</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">analytical_solution_fun</span><span class="p">):</span>
    <span class="c1"># Helper function to generate datasets from analytical solutions.</span>
    

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_dom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delta_X</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_dom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delta_T</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">psi_val</span> <span class="o">=</span> <span class="n">analytical_solution_fun</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">omega</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">psi_val</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">psi_val</span><span class="p">)</span>

    <span class="n">train_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">X</span><span class="p">,</span><span class="n">T</span><span class="p">))</span>
    <span class="n">train_output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">))</span>

    <span class="n">train_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">train_input</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">train_y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">train_output</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define domain in code</span>

<span class="n">L</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">delta_T</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">delta_X</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">x_dom</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">L</span><span class="p">,</span><span class="n">L</span><span class="p">]</span>
<span class="n">t_dom</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">L</span><span class="p">]</span>
<span class="n">analytical_solution_function</span> <span class="o">=</span> <span class="n">get_analytical_solution_base</span>

<span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">get_data_set</span><span class="p">(</span><span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">delta_X</span><span class="p">,</span> <span class="n">delta_T</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">analytical_solution_function</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">delta_T</span></code> and <code class="docutils literal notranslate"><span class="pre">delta_X</span></code> are the grid spacing in our domain. Data will be generated on this grid. The probabilty density of the QHO evolves in time and our system looks like this:</p>
<div>
<img src="https://github.com/GDS-Education-Community-of-Practice/DSECOP/blob/main/Learning_the_Schrodinger_Equation/res/plots/waveform/psi_0_1/animation.gif?raw=true" width=800></img>
</div><p>Now that we have the analytical solution, let’s build a neural network to solve it.</p>
<p>We will be using Mean Squared Error to quantify the difference between the true value and predicted values.
It is defined as</p>
<div class="math notranslate nohighlight">
\[ \Large
\mathrm{MSE}=\frac{1}{n} \sum_{i=1}^{n}\left(Y_{i}-\hat{Y}_{i}\right)^{2}
\]</div>
<p>where <span class="math notranslate nohighlight">\(Y_i\)</span> and <span class="math notranslate nohighlight">\(\hat{Y_i}\)</span> are the <span class="math notranslate nohighlight">\(i^{\rm th}\)</span> predicted and true values respectively. Implement this in code below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exercise: Implement mse function here</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_mse</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    
    <span class="c1"># Solution:</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mse</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="span-style-color-lightgreen-fully-connected-neural-network-span">
<h3><span style="color:LightGreen">Fully Connected Neural Network</span><a class="headerlink" href="#span-style-color-lightgreen-fully-connected-neural-network-span" title="Permalink to this heading">#</a></h3>
<p>A neural network consists of chained linear regression nodes (perceptrons) and activation functions. The first layer is called the input layer, the layers in the middele are called output layers and the final layer is called the output layer. A neural network surves as a function approximator between the input and the ouput.</p>
<p><img alt="Domains" src="https://github.com/GDS-Education-Community-of-Practice/DSECOP/blob/main/Learning_the_Schrodinger_Equation/res/fig/nn_architecture.png?raw=1" /></p>
<p>Since neural networks are constrained to <span class="math notranslate nohighlight">\(\mathbb{R}\)</span>, the complex valued solution can be represented as</p>
<div class="math notranslate nohighlight">
\[ \Large
\psi(x,t) = u + iv    
\]</div>
<p>where <span class="math notranslate nohighlight">\(u = \operatorname{Re}(\psi)\)</span> and <span class="math notranslate nohighlight">\(v=\operatorname{Im}(\psi)\)</span></p>
<p><em><strong><span style="color:Violet">Exercise</span></strong></em>: What our input and output variable for this neural network?</p>
<p>Solution: Inputs: <span class="math notranslate nohighlight">\(x,t\)</span>, Outputs: <span class="math notranslate nohighlight">\(u,v\)</span></p>
<p><em><strong><span style="color:Violet">Exercise</span></strong></em>:: Write the Schrodinger equation in terms of <span class="math notranslate nohighlight">\(u\)</span> and <span class="math notranslate nohighlight">\(v\)</span></p>
<p>Solution:
The time-dependent Schrödinger equation can be written as</p>
<div class="math notranslate nohighlight">
\[ \Large
    \left(-\frac{\partial v}{\partial t}+\frac{1}{2}\frac{\partial^{2} u}{\partial x^{2}}-\frac{\omega^{2}}{2}x^{2}\right)\psi + i \left(\frac{\partial u}{\partial t}+\frac{1}{2}\frac{\partial^{2} v}{\partial x^{2}}-\frac{\omega^{2}}{2}x^{2}\right)\psi = 0
\]</div>
<p>In the first case, the training data is generated on a high resolution grid from the analytical solution described above.
The neural network <span class="math notranslate nohighlight">\(\psi_{net}: \mathbb{R}^{1+1}\mapsto \mathbb{R}^{2}\)</span> is constructed, with inputs <span class="math notranslate nohighlight">\((x,t)\)</span> and outputs <span class="math notranslate nohighlight">\((u,v)\)</span>.</p>
<p>Let’s look at the pipeline for creating, training and testing Neural Networks. Generate training and test data:</p>
<p>Note: In this case, we are using the entire dataset in training for demonstrating the workflow. This is not done in practice and leads to overfitting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Grid spacing</span>
<span class="n">delta_T</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">delta_X</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="c1"># Domains</span>
<span class="n">x_dom</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">L</span><span class="p">,</span><span class="n">L</span><span class="p">]</span>
<span class="n">t_dom</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">L</span><span class="p">]</span>

<span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span> <span class="o">=</span> <span class="n">get_data_set</span><span class="p">(</span><span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">delta_X</span><span class="p">,</span> <span class="n">delta_T</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">get_analytical_solution_base</span><span class="p">)</span>
<span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">get_data_set</span><span class="p">(</span><span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">delta_X</span><span class="p">,</span> <span class="n">delta_T</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">get_analytical_solution_base</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Create the architecture of Neural Network. This is a fully connected neural network (FCN):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">NN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_in</span><span class="p">,</span> <span class="n">n_out</span><span class="p">,</span> <span class="n">n_h</span><span class="p">,</span> <span class="n">n_l</span><span class="p">,</span> <span class="n">activation</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">f_in</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">n_in</span><span class="p">,</span> <span class="n">n_h</span><span class="p">)</span>
        
        <span class="n">layers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">n_h</span><span class="p">,</span> <span class="n">n_h</span><span class="p">))</span>
            <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">activation</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">f_h</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="n">layers</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">f_out</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">n_h</span><span class="p">,</span> <span class="n">n_out</span><span class="p">)</span>
        
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_in</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">activation</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_h</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_out</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<p>Create a function to train the network:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">train_nn</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">n_epochs</span><span class="p">,</span> <span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">):</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span><span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>

    <span class="n">loss_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Epoch </span><span class="se">\t</span><span class="s2"> Loss&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">):</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">pred_y</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>

        <span class="n">loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">train_y</span><span class="o">-</span><span class="n">pred_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">loss_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">loss</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">500</span> <span class="o">==</span> <span class="mi">499</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">loss</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_list</span>
</pre></div>
</div>
</div>
</div>
<p>Create a function to quantify the loss and errors</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_model_error</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>

        <span class="n">pred_y</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
        
        <span class="n">pred_u</span><span class="p">,</span> <span class="n">pred_v</span><span class="p">,</span> <span class="n">pred_dens</span> <span class="o">=</span> <span class="n">get_density</span><span class="p">(</span><span class="n">pred_y</span><span class="p">)</span>
        <span class="n">test_u</span><span class="p">,</span> <span class="n">test_v</span><span class="p">,</span> <span class="n">test_dens</span> <span class="o">=</span> <span class="n">get_density</span><span class="p">(</span><span class="n">test_y</span><span class="p">)</span>
        
        <span class="n">loss_u</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">pred_u</span> <span class="o">-</span> <span class="n">test_u</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">loss_v</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">pred_v</span> <span class="o">-</span> <span class="n">test_v</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">loss_dens</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">pred_dens</span> <span class="o">-</span> <span class="n">test_dens</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model loss: </span><span class="se">\n</span><span class="s2"> loss_u = </span><span class="si">{</span><span class="n">loss_u</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> loss_v = </span><span class="si">{</span><span class="n">loss_v</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> loss_dens = </span><span class="si">{</span><span class="n">loss_dens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">pred_y</span>
</pre></div>
</div>
</div>
</div>
<p>Function for inference and plotting</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">inference</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span><span class="n">n_x</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span><span class="n">plot_name</span><span class="o">=</span><span class="s2">&quot;plot&quot;</span><span class="p">):</span>
    
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>

        <span class="n">pred_y</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
        
        <span class="n">pred_u</span><span class="p">,</span> <span class="n">pred_v</span><span class="p">,</span> <span class="n">pred_dens</span> <span class="o">=</span> <span class="n">get_density</span><span class="p">(</span><span class="n">pred_y</span><span class="p">)</span>
        <span class="n">test_u</span><span class="p">,</span> <span class="n">test_v</span><span class="p">,</span> <span class="n">test_dens</span> <span class="o">=</span> <span class="n">get_density</span><span class="p">(</span><span class="n">test_y</span><span class="p">)</span>

        <span class="n">loss_u</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">pred_u</span> <span class="o">-</span> <span class="n">test_u</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">loss_v</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">pred_v</span> <span class="o">-</span> <span class="n">test_v</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">loss_dens</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">pred_dens</span> <span class="o">-</span> <span class="n">test_dens</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
         
        <span class="c1"># print(loss_u)</span>
        <span class="c1"># print(loss_v)</span>
            
        <span class="n">get_plots_norm_colorbar</span><span class="p">(</span><span class="n">test_y</span><span class="p">,</span><span class="n">pred_y</span><span class="p">,</span> <span class="n">n_x</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">plot_name</span><span class="p">)</span>
        <span class="c1"># return pred_y</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have all the pieces in place, we can use this code to train a neural network on our domain.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">314</span><span class="p">)</span>
<span class="n">activation</span> <span class="o">=</span>  <span class="n">nn</span><span class="o">.</span><span class="n">Tanh</span><span class="p">()</span>

<span class="n">model_nn</span> <span class="o">=</span> <span class="n">NN</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">activation</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">10000</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">model_nn</span><span class="p">,</span> <span class="n">loss_list</span> <span class="o">=</span> <span class="n">train_nn</span><span class="p">(</span><span class="n">model_nn</span><span class="p">,</span> <span class="n">n_epochs</span><span class="p">,</span> <span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 	 Loss
499 0.0213115763026825
999 0.006381095573092086
1499 0.002607264671975365
1999 0.001603071359125186
2499 0.001109473421817362
2999 0.0007699277146174733
3499 0.000507701989183921
3999 0.00040644379600978894
4499 0.0003550058407072698
4999 0.000305281928907047
5499 0.0002656753852639507
5999 0.0003334157921503728
6499 0.00021944491494818154
6999 0.0002172963900096806
7499 0.0001671912112379878
7999 0.00015000718012489117
8499 0.00013687427073621382
8999 0.0001250454882763153
9499 0.00011768072369643653
9999 0.00010751122723376519
CPU times: user 1min 48s, sys: 23 s, total: 2min 11s
Wall time: 17.2 s
</pre></div>
</div>
</div>
</div>
<p>The losses for different terms are:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pred_y</span> <span class="o">=</span> <span class="n">get_model_error</span><span class="p">(</span><span class="n">model_nn</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model loss: 
 loss_u = 0.00010752771343785204 
 loss_v = 0.00010748260573661646 
 loss_dens = 8.357010733244751e-05
</pre></div>
</div>
</div>
</div>
<p>And we can plot our reults with the inference function</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">delta_T</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">delta_X</span> <span class="o">=</span> <span class="mf">0.1</span>
    
<span class="n">n_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_dom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delta_X</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">n_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_dom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delta_T</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">inference</span><span class="p">(</span><span class="n">model_nn</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">n_x</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="s1">&#39;nn&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 finished
1 finished
2 finished
</pre></div>
</div>
<img alt="../../_images/8159aca78603416aeb4104869d4999d7bd177b59c552cd4e687d9209d23097ae.png" src="../../_images/8159aca78603416aeb4104869d4999d7bd177b59c552cd4e687d9209d23097ae.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mse: u: 0.00010752771343785201, v:0.00010748260573661646
</pre></div>
</div>
</div>
</div>
<p>Reading these snapshot plots:
The first column consists of plots of neural network predictions The second column consists of true values and the last column is the Absolute Error between ground truth and predictions.</p>
<p>The rows are real(<span class="math notranslate nohighlight">\(\psi\)</span>), imaginary(<span class="math notranslate nohighlight">\(\psi\)</span>) and density <span class="math notranslate nohighlight">\(|\psi|^2\)</span> .</p>
<p>In this case, since we used all the data over the domain for training, we get great results, where the NN approximates <span class="math notranslate nohighlight">\(\psi\)</span> very well.</p>
<p>Now for a more realistic case. We might not have a lot of experimental data covering the entire domain of a system. To approximate that, let’s train a neural network on a low resolution grid in a reduced domain <span class="math notranslate nohighlight">\(x \in [-\pi/4,\pi/4]\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate reduced training set</span>
<span class="n">L</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">delta_T</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">delta_X</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">x_dom</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="n">L</span><span class="o">/</span><span class="mi">4</span><span class="p">]</span>
<span class="n">t_dom</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">L</span><span class="p">]</span>

<span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span> <span class="o">=</span> <span class="n">get_data_set</span><span class="p">(</span><span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">delta_X</span><span class="p">,</span> <span class="n">delta_T</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">get_analytical_solution_base</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We will test it’s performance on a high resolution grid across the entire domain</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">delta_T</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">delta_X</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">x_dom</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">L</span><span class="p">,</span><span class="n">L</span><span class="p">]</span>
<span class="n">t_dom</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">L</span><span class="p">]</span>

<span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">get_data_set</span><span class="p">(</span><span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">delta_X</span><span class="p">,</span> <span class="n">delta_T</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">get_analytical_solution_base</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">314</span><span class="p">)</span>
<span class="n">activation</span> <span class="o">=</span>  <span class="n">nn</span><span class="o">.</span><span class="n">Tanh</span><span class="p">()</span>

<span class="n">model_nn</span> <span class="o">=</span> <span class="n">NN</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">activation</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">10000</span>

    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">model_nn</span><span class="p">,</span> <span class="n">loss_list</span> <span class="o">=</span> <span class="n">train_nn</span><span class="p">(</span><span class="n">model_nn</span><span class="p">,</span> <span class="n">n_epochs</span><span class="p">,</span> <span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 	 Loss
499 0.0280495968496817
999 0.009690420348012766
1499 0.002138187328487201
1999 0.0010539041688532023
2499 0.0006480188367960882
2999 0.0004383058659488573
3499 0.0003361657476766466
3999 0.00027129779263142527
4499 0.0006277442880550771
4999 0.0001859823472012481
5499 0.00015291338629913438
5999 0.00012775851488639698
6499 0.00011071085829663684
6999 0.0003028366196810422
7499 0.00025020218896733504
7999 6.851536886864664e-05
8499 0.0006968533175957446
8999 6.234750123461479e-05
9499 5.06971087803799e-05
9999 4.505391903343265e-05
CPU times: user 56.6 s, sys: 11.7 s, total: 1min 8s
Wall time: 9.61 s
</pre></div>
</div>
</div>
</div>
<p>So far so good, the training loss is small. But across the entire domain, the loss is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">get_model_error</span><span class="p">(</span><span class="n">model_nn</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model loss: 
 loss_u = 0.27843895074674907 
 loss_v = 0.5049001767812281 
 loss_dens = 3.959586184871224
</pre></div>
</div>
</div>
</div>
<p>The error is orders of magnitude higher than our data point values! Let’s look at the plots:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">delta_T</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">delta_X</span> <span class="o">=</span> <span class="mf">0.01</span>
    
<span class="n">n_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_dom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delta_X</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">n_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_dom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delta_T</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">inference</span><span class="p">(</span><span class="n">model_nn</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">n_x</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="s1">&#39;nn_reduced&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 finished
1 finished
2 finished
</pre></div>
</div>
<img alt="../../_images/ec7514737215730263dde31efcc325706cd4b6e21cc25dd049b40d7dad745f02.png" src="../../_images/ec7514737215730263dde31efcc325706cd4b6e21cc25dd049b40d7dad745f02.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mse: u: 0.27843895074674907, v:0.5049001767812281
</pre></div>
</div>
</div>
</div>
<p>The values are similar in the domain that we trained on <span class="math notranslate nohighlight">\(x \in [-0.78,0.78]\)</span> but diverge considerably near the boundaries.</p>
<p>To tackle this problem, we will add some information about the governing equation in the neural network.</p>
</section>
<section id="span-style-color-lightgreen-physics-informed-neural-network">
<h3><span style="color:LightGreen">Physics-Informed Neural Network<a class="headerlink" href="#span-style-color-lightgreen-physics-informed-neural-network" title="Permalink to this heading">#</a></h3>
<p>Physics Informed Neural Networks are constructed by encoding the constraints posed by a given differential equation and its boundary conditions into the loss function of a Fully Connected Network. This constraint guides the network to approximate the solution of the differential equation.</p>
<p>For a system <span class="math notranslate nohighlight">\(f\)</span>, with solution <span class="math notranslate nohighlight">\(u(\mathbf{x},t)\)</span>, governed by the following equation</p>
<div class="math notranslate nohighlight">
\[\begin{split} \Large
f(u) = u_{t}+\mathcal{N}[u;\lambda], ~~~\mathbf{x} \in \Omega, t \in [0,T] \\
f(u) = 0 ~~~~~~~~~~~~~ \rm{otherwise}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathcal{N}[u;\lambda]\)</span> is a differential operator parameterised by <span class="math notranslate nohighlight">\( \lambda \)</span>, <span class="math notranslate nohighlight">\( \Omega \in \mathbb{R^D} \)</span>, <span class="math notranslate nohighlight">\( \mathbf{x} = (x_1,x_2,...,x_d) \)</span> with boundary conditions</p>
<div class="math notranslate nohighlight">
\[ \Large
\mathcal{B}(u, \mathbf{x},t)=0 \quad \text { on } \quad \partial \Omega
\]</div>
<p>and initial conditions</p>
<div class="math notranslate nohighlight">
\[ \Large
\mathcal{T}(u, \mathbf{x},t)=0 \quad \text { at } \quad t = 0
\]</div>
<p><img alt="PINN architecture" src="https://github.com/GDS-Education-Community-of-Practice/DSECOP/blob/main/Learning_the_Schrodinger_Equation/res/fig/PINN_diagrams.png?raw=1" /></p>
<p>A neural network <span class="math notranslate nohighlight">\(u_{net}: \mathbb{R}^{D+1}\mapsto \mathbb{R}^{1}\)</span> is constructed as a surrogate model for the true solution <span class="math notranslate nohighlight">\(u\)</span>,</p>
<div class="math notranslate nohighlight">
\[ \Large
f_{net}=f(u_{net})
\]</div>
<p>The constraints imposed by the system are encoded in the loss term <span class="math notranslate nohighlight">\(L\)</span> for neural network optimisation</p>
<div class="math notranslate nohighlight">
\[ \Large
L={\color{green} L_{f}}+{\color{red} L_{BC}}+{\color{blue} L_{IC}}
\]</div>
<p>where <span class="math notranslate nohighlight">\(L_{f}\)</span> denotes the error in the solution within the interior points of the system, enforcing the PDE. This error is calculated for <span class="math notranslate nohighlight">\(N_f\)</span> collocation points.</p>
<div class="math notranslate nohighlight">
\[ \Large
\color{green} 
L_{f}=\frac{1}{N_{f}} \sum_{i=1}^{N_{f}}\left|f_{net}\left(\mathbf{x}_{f}^{i}, t_{f}^{i}\right)\right|^{2}
\]</div>
<div class="math notranslate nohighlight">
\[ \Large
\color{red} 
L_{BC}=\frac{1}{N_{BC}} \sum_{i=1}^{N_{BC}}\left|u\left(\mathbf{x}_{BC}^{i}, t_{BC}^{i}\right)-u^{i}\right|^{2}
\]</div>
<div class="math notranslate nohighlight">
\[ \Large
\color{blue} 
L_{IC}=\frac{1}{N_{IC}} \sum_{i=1}^{N_{IC}}\left|u\left(\mathbf{x}_{IC}^{i}, t_{IC}^{i}\right)-u^{i}\right|^{2}
\]</div>
<p><span class="math notranslate nohighlight">\(L_{BC}\)</span> and <span class="math notranslate nohighlight">\(L_{IC}\)</span> represent the constraints imposed by the boundary and initial conditions, calculated on a set of <span class="math notranslate nohighlight">\(N_{BC}\)</span> boundary points and <span class="math notranslate nohighlight">\(N_{IC}\)</span> initial points respectively, with <span class="math notranslate nohighlight">\(u_i\)</span> being the ground truth.</p>
<a class="reference internal image-reference" href="https://github.com/GDS-Education-Community-of-Practice/DSECOP/blob/main/Learning_the_Schrodinger_Equation/res/fig/colloc_points.png?raw=1"><img alt="Domain" src="https://github.com/GDS-Education-Community-of-Practice/DSECOP/blob/main/Learning_the_Schrodinger_Equation/res/fig/colloc_points.png?raw=1" style="width: 400px;" /></a>
<p>Once sufficiently trained, the network can be used as a solver for the PDE, potentially for a range of parameters <span class="math notranslate nohighlight">\( \lambda \)</span>.</p>
<p>Since PINNs can be used to solve systems of arbitrary resolutions once they are trained and generalise well over different parameter spaces, they might be used to accelerate the solution of PDEs.</p>
<p>The following function creates the collocation points for the equation, boundary and initial conditions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_physics_colloc_points</span><span class="p">(</span><span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">delta_X</span><span class="p">,</span> <span class="n">delta_T</span><span class="p">,</span><span class="n">analytical_solution_function</span><span class="p">):</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_dom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delta_X</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_dom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delta_T</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    
    <span class="n">x_physics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">t_physics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">x_physics</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">x_physics</span><span class="p">)</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">t_physics</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">t_physics</span><span class="p">)</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="n">f_colloc</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">x_physics</span><span class="p">,</span> <span class="n">t_physics</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    
    <span class="n">t_ic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">X_ic</span><span class="p">,</span> <span class="n">T_ic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t_ic</span><span class="p">)</span>
    
    <span class="n">x_ic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">X_ic</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">t_ic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">T_ic</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">ic_sol</span> <span class="o">=</span> <span class="n">analytical_solution_function</span><span class="p">(</span><span class="n">x_ic</span><span class="p">,</span><span class="n">t_ic</span><span class="p">,</span> <span class="n">omega</span><span class="p">)</span>
    <span class="n">ic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ic_sol</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">ic_sol</span><span class="p">)))</span>
    
    <span class="n">ic</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    
    <span class="n">x_ic</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">x_ic</span><span class="p">)</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">t_ic</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">t_ic</span><span class="p">)</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="n">ic_colloc</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">x_ic</span><span class="p">,</span> <span class="n">t_ic</span><span class="p">))</span>
    
    <span class="n">x_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_dom</span><span class="p">)</span>
    <span class="n">X_b</span><span class="p">,</span> <span class="n">T_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_b</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">x_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">X_b</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">t_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">T_b</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">x_b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">x_b</span><span class="p">)</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">t_b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">t_b</span><span class="p">)</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="n">b_colloc</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">x_b</span><span class="p">,</span> <span class="n">t_b</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">x_physics</span><span class="p">,</span> <span class="n">t_physics</span><span class="p">,</span><span class="n">f_colloc</span><span class="p">,</span> <span class="n">b_colloc</span><span class="p">,</span> <span class="n">ic_colloc</span><span class="p">,</span> <span class="n">ic</span>

<span class="n">omega</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">x_dom</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">L</span><span class="p">,</span><span class="n">L</span><span class="p">]</span>
<span class="n">t_dom</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">L</span><span class="p">]</span>
<span class="n">delta_x</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">delta_t</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">analytical_solution_function</span> <span class="o">=</span> <span class="n">get_analytical_solution_base</span>
<span class="n">x_physics</span><span class="p">,</span> <span class="n">t_physics</span><span class="p">,</span> <span class="n">f_colloc</span><span class="p">,</span> <span class="n">b_colloc</span><span class="p">,</span> <span class="n">ic_colloc</span><span class="p">,</span> <span class="n">ic</span> <span class="o">=</span> <span class="n">get_physics_colloc_points</span><span class="p">(</span><span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">delta_x</span><span class="p">,</span> <span class="n">delta_t</span><span class="p">,</span> <span class="n">analytical_solution_function</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em><strong><span style="color:Violet">Exercise</span></strong></em>: What will the loss terms look like in this case?</p>
<p>Hint: Split the Schrodinger equation in real and imaginary parts to calculate the equation loss.</p>
<p>Solution: The time-dependent Schrödinger equation can be written as</p>
<div class="math notranslate nohighlight">
\[ \Large
    \left(-\frac{\partial v}{\partial t}+\frac{1}{2}\frac{\partial^{2} u}{\partial x^{2}}-\frac{\omega^{2}}{2}x^{2}\right) + i \left(\frac{\partial u}{\partial t}+\frac{1}{2}\frac{\partial^{2} v}{\partial x^{2}}-\frac{\omega^{2}}{2}x^{2}\right) = 0
\]</div>
<p>The loss function <span class="math notranslate nohighlight">\(L\)</span> is given by</p>
<div class="math notranslate nohighlight">
\[ \Large
L=L_{f}+L_{BC}+L_{IC}
\]</div>
<div class="math notranslate nohighlight">
\[ \Large
L_{BC}=\frac{1}{N_{BC}} \sum_{i=1}^{N_{BC}}\left(\left|u\left(\mathbf{r}_{BC}^{i}, t_{BC}^{i}\right)-u^{i}\right|^{2}+\left|v\left(\mathbf{r}_{BC}^{i}, t_{BC}^{i}\right)-v^{i}\right|^{2}\right)
\]</div>
<div class="math notranslate nohighlight">
\[ \Large
L_{IC}=\frac{1}{N_{IC}} \sum_{i=1}^{N_{IC}}\left(\left|v\left(\mathbf{r}_{IC}^{i}, t_{IC}^{i}\right)-u^{i}\right|^{2}+\left|v\left(\mathbf{r}_{IC}^{i}, t_{IC}^{i}\right)-v^{i}\right|^{2}\right)
\]</div>
<div class="math notranslate nohighlight">
\[ \Large
L_{f}=\frac{1}{N_{f}} \sum_{i=1}^{N_{f}}\left|f_{net}\left(\mathbf{r}_{f}^{i}, t_{f}^{i}\right)\right|^{2}
\]</div>
<p>At each training step, the loss function is calculated on <span class="math notranslate nohighlight">\(N_f\)</span> collocation points, sampled randomly from the grid.</p>
<p>We need to modify the training loop to calculate the new physics informed loss function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">train_pinn</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">n_epochs</span><span class="p">,</span> <span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">x_physics</span><span class="p">,</span> <span class="n">t_physics</span><span class="p">,</span> <span class="n">f_colloc</span><span class="p">,</span> <span class="n">b_colloc</span><span class="p">,</span> <span class="n">ic_colloc</span><span class="p">,</span> <span class="n">ic</span><span class="p">):</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span><span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
    <span class="n">loss_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Epoch </span><span class="se">\t</span><span class="s2"> Loss </span><span class="se">\t</span><span class="s2"> PDE Loss&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">):</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>

        <span class="n">loss1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_pred</span><span class="o">-</span><span class="n">train_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># calculate loss on colloc points</span>

        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">f_colloc</span><span class="p">)</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">y_pred</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">y_pred</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">du_dx</span>  <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">x_physics</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">du_dxx</span>  <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">du_dx</span><span class="p">,</span> <span class="n">x_physics</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">du_dx</span><span class="p">),</span> <span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">du_dt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">,</span>  <span class="n">t_physics</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_pred</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span>  <span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;flag_2&quot;</span><span class="p">)</span>
        <span class="n">dv_dx</span>  <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">x_physics</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dv_dxx</span>  <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">dv_dx</span><span class="p">,</span> <span class="n">x_physics</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">dv_dx</span><span class="p">),</span> <span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dv_dt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">,</span>  <span class="n">t_physics</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">v</span><span class="p">),</span>  <span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;flag_3&quot;</span><span class="p">)</span>
        <span class="n">loss_u</span> <span class="o">=</span> <span class="o">-</span><span class="n">du_dt</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">dv_dxx</span> <span class="o">+</span> <span class="n">omega</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x_physics</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">loss_v</span> <span class="o">=</span> <span class="o">-</span><span class="n">dv_dt</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">du_dxx</span> <span class="o">+</span> <span class="n">omega</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x_physics</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">loss_physics</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">loss_u</span><span class="p">,</span> <span class="n">loss_v</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;flag_4&quot;</span><span class="p">)</span>
        <span class="n">y_pred_b</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">b_colloc</span><span class="p">)</span>
        <span class="n">y_pred_ic</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">ic_colloc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;flag_5&quot;</span><span class="p">)</span>
        <span class="n">loss_b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_pred_b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">loss_ic</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_pred_ic</span> <span class="o">-</span> <span class="n">ic</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">loss2</span> <span class="o">=</span>  <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">loss_physics</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">loss_b</span> <span class="o">+</span> <span class="n">loss_ic</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;flag_6&quot;</span><span class="p">)</span>
        

        <span class="n">loss</span> <span class="o">=</span> <span class="n">loss1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1e-4</span><span class="p">)</span> <span class="o">*</span> <span class="n">loss2</span><span class="c1"># add two loss terms together</span>
        <span class="n">loss_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">loss</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;flag_7&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">500</span> <span class="o">==</span> <span class="mi">499</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">loss</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">loss2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_list</span>
</pre></div>
</div>
</div>
</div>
<p>We will now train the PINN on the same reduced domain</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">activation</span> <span class="o">=</span>  <span class="n">nn</span><span class="o">.</span><span class="n">Tanh</span><span class="p">()</span>

<span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">model_pinn</span> <span class="o">=</span> <span class="n">NN</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">activation</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">model_pinn</span><span class="p">,</span> <span class="n">loss_pinn</span> <span class="o">=</span> <span class="n">train_pinn</span><span class="p">(</span><span class="n">model_pinn</span><span class="p">,</span> <span class="n">n_epochs</span><span class="p">,</span> <span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">x_physics</span><span class="p">,</span> <span class="n">t_physics</span><span class="p">,</span> <span class="n">f_colloc</span><span class="p">,</span> <span class="n">b_colloc</span><span class="p">,</span> <span class="n">ic_colloc</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 	 Loss 	 PDE Loss
499 0.014588414251169458 0.5443244929559576
999 0.0020570294161056523 0.4798914731997963
1499 0.0007510534236043466 0.3206896225661473
1999 0.00039025409281648375 0.2743827609589016
2499 0.0002352930945909385 0.2565677862193554
2999 0.00015686196706198008 0.2478984727216319
3499 0.00011534335880468258 0.24316524694599004
3999 0.00026287114203943807 0.23552571614393783
4499 8.460051347531427e-05 0.22853465243318152
4999 7.879858460994293e-05 0.22003044519985812
5499 6.06124125286827e-05 0.2148690466689354
5999 0.00011716101862730677 0.2079739738894505
6499 6.970775526306723e-05 0.20501915340643292
6999 4.6419685141038864e-05 0.2009047493338139
7499 4.417519016271358e-05 0.19728154943524615
7999 4.1270563617775325e-05 0.19497542651932778
8499 4.0412979996635944e-05 0.19194412689085263
8999 3.731735901610303e-05 0.19049675059561139
9499 3.704126578130983e-05 0.1880710380417881
9999 3.4215836758528444e-05 0.18686385961028093
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">get_model_error</span><span class="p">(</span><span class="n">model_pinn</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model loss: 
 loss_u = 0.0051744012806154704 
 loss_v = 0.004228406481830343 
 loss_dens = 0.00108018392215922
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">delta_T</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">delta_X</span> <span class="o">=</span> <span class="mf">0.01</span>
    
<span class="n">n_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_dom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delta_X</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">n_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_dom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delta_T</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">inference</span><span class="p">(</span><span class="n">model_pinn</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">n_x</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="s1">&#39;pinn_reduced&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 finished
1 finished
2 finished
</pre></div>
</div>
<img alt="../../_images/c21d6efd8514d9567b4d153a028be639f9649125293c59804b02836d86f3e819.png" src="../../_images/c21d6efd8514d9567b4d153a028be639f9649125293c59804b02836d86f3e819.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mse: u: 0.005174401280615469, v:0.004228406481830342
</pre></div>
</div>
</div>
</div>
<p>The PINN model matches the system well, even when trained on reduced data.</p>
<section id="span-style-color-orange-training-considerations-span">
<h4><span style="color:Orange">Training Considerations</span><a class="headerlink" href="#span-style-color-orange-training-considerations-span" title="Permalink to this heading">#</a></h4>
<section id="span-style-color-violet-architecture-span">
<h5><span style="color:Violet">Architecture</span><a class="headerlink" href="#span-style-color-violet-architecture-span" title="Permalink to this heading">#</a></h5>
<p>The architecture and associated hyperparameters have significant impact on the performance of the PINN. The learning model architecture can be customized depending on the nature of the domain. For example, CNNs, RNNs and GNNs can be used for spatial, temporal and interacting problems respectively. For the one-dimensional quantum harmonic oscillator workflow, we use a FCN with 3 layers of 20 neurons each.</p>
<p>Optimizer selection is important for convergence of the learner and to avoid solutions at local minima. It has been shown that a combination of Adam  at early training and L-BFGS for later stages has been effective for solving a variety of PDEs through PINNs. We use the Adam optimizer only given the relatively simple nature of this problem.</p>
<p><em><strong><span style="color:Violet">Exercise</span></strong></em>: Try running the PINN with ReLU activation function. What are your observations? Why would this activation function not work?</p>
<p>Solution: As we saw in calculating the residual, the choice of activation functions is constrained by the fact that they have to be <span class="math notranslate nohighlight">\((n+1)\)</span>-differentiable for <span class="math notranslate nohighlight">\(n\)</span>-order PDEs. For the one-dimensional quantum harmonic oscillator problem we use <span class="math notranslate nohighlight">\(\tanh\)</span> activation functions because they are 3-differentiable.</p>
</section>
<section id="span-style-color-violet-collection-points-span">
<h5><span style="color:Violet">Collection Points</span><a class="headerlink" href="#span-style-color-violet-collection-points-span" title="Permalink to this heading">#</a></h5>
<p>The accuracy of the NN increases with increase in density of collocation points. However, the computational resources required also increases exponentially with the increase in density of points. This can lead to training bottlenecks, especially for high dimensional systems. A trade-off has to be made between the desired accuracy and number of collocation points because training the NN on a large number of points may lead to overfitting and adversely affect generalisability. The distribution of points can also be customised according to the problem domain. Density could be increased around areas of sharp discontinuities to capture more information about the domain.</p>
<p><em><strong><span style="color:Violet">Exercise</span></strong></em>: What is the effect of changing collocation points on the training time and accuracy of the Neural Network? You can run it multiple times with different grids of collocation point to observe this.</p>
<p>Solution</p>
<p>Training time and accuracy both increase exponentially with collocation grid size.</p>
<a class="reference internal image-reference" href="https://raw.githubusercontent.com/GDS-Education-Community-of-Practice/DSECOP/main/Learning_the_Schrodinger_Equation/res/fig/pinn_colloc_time.png"><img alt="Domain" src="https://raw.githubusercontent.com/GDS-Education-Community-of-Practice/DSECOP/main/Learning_the_Schrodinger_Equation/res/fig/pinn_colloc_time.png" style="width: 400px;" /></a>
<a class="reference internal image-reference" href="https://raw.githubusercontent.com/GDS-Education-Community-of-Practice/DSECOP/main/Learning_the_Schrodinger_Equation/res/fig/pinn_colloc_performance.png"><img alt="Domain" src="https://raw.githubusercontent.com/GDS-Education-Community-of-Practice/DSECOP/main/Learning_the_Schrodinger_Equation/res/fig/pinn_colloc_performance.png" style="width: 400px;" /></a>
</section>
</section>
</section>
</section>
<hr class="docutils" />
<section id="span-style-color-orange-higher-energy-states-span">
<h2><span style="color:Orange">Higher Energy States</span><a class="headerlink" href="#span-style-color-orange-higher-energy-states-span" title="Permalink to this heading">#</a></h2>
<p>We will now check the performance of NNs on systems with higher energy states. For demonstration, the system used is <span class="math notranslate nohighlight">\(\psi_{1,3}(x,t)\)</span>.  The analytic solution is implemented in the method below (I will leave it to you to derive it)</p>
<p>Let’s write some code to compute it for arbitrary values of <span class="math notranslate nohighlight">\(x,t,\omega\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_analytical_solution_1_3</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">T</span><span class="p">,</span> <span class="n">omega</span><span class="p">):</span>
    <span class="c1">#Solution:</span>
    <span class="n">phi_0</span> <span class="o">=</span><span class="p">(</span><span class="n">omega</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">4.</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">X</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">X</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
    <span class="n">phi_1</span> <span class="o">=</span> <span class="n">phi_0</span> <span class="o">*</span>  <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">omega</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">X</span>
    <span class="n">phi_3</span> <span class="o">=</span> <span class="n">phi_0</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">48</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">8.</span> <span class="o">*</span> <span class="n">omega</span><span class="o">**</span><span class="p">(</span><span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="o">*</span> <span class="n">X</span><span class="o">**</span><span class="mf">3.</span> <span class="o">-</span> <span class="mf">12.</span> <span class="o">*</span> <span class="n">omega</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="o">*</span> <span class="n">X</span><span class="p">)</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">phi_1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="mf">7.</span><span class="o">/</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">phi_3</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">psi</span>
</pre></div>
</div>
</div>
</div>
<p>You can explore the system here:</p>
<p><a class="reference internal" href="https://github.com/GDS-Education-Community-of-Practice/DSECOP/blob/main/Learning_the_Schrodinger_Equation/res/plots/waveform/psi_1_3/animation.gif?raw=true"><img alt="https://github.com/GDS-Education-Community-of-Practice/DSECOP/blob/main/Learning_the_Schrodinger_Equation/res/plots/waveform/psi_1_3/animation.gif?raw=true" class="align-left" src="https://github.com/GDS-Education-Community-of-Practice/DSECOP/blob/main/Learning_the_Schrodinger_Equation/res/plots/waveform/psi_1_3/animation.gif?raw=true" style="width: 800px;" /></a></img><br></p>
<p>Using a reduced grid with Fully Connected Network, we have</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">delta_T</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">delta_X</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">x_dom</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="n">L</span><span class="o">/</span><span class="mi">4</span><span class="p">]</span>
<span class="n">t_dom</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">L</span><span class="p">]</span>

<span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span> <span class="o">=</span> <span class="n">get_data_set</span><span class="p">(</span><span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">delta_X</span><span class="p">,</span> <span class="n">delta_T</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">get_analytical_solution_1_3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">delta_T</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">delta_X</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">x_dom</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">L</span><span class="p">,</span><span class="n">L</span><span class="p">]</span>
<span class="n">t_dom</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">L</span><span class="p">]</span>

<span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">get_data_set</span><span class="p">(</span><span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">delta_X</span><span class="p">,</span> <span class="n">delta_T</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">get_analytical_solution_1_3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">314</span><span class="p">)</span>
<span class="n">activation</span> <span class="o">=</span>  <span class="n">nn</span><span class="o">.</span><span class="n">Tanh</span><span class="p">()</span>

<span class="n">model_nn_he</span> <span class="o">=</span> <span class="n">NN</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">activation</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model_nn_he</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span><span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>

<span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">10000</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">model_nn_he</span><span class="p">,</span> <span class="n">loss_list</span> <span class="o">=</span> <span class="n">train_nn</span><span class="p">(</span><span class="n">model_nn_he</span><span class="p">,</span> <span class="n">n_epochs</span><span class="p">,</span> <span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 	 Loss
499 0.034809462864400655
999 0.030770489596605062
1499 0.029024043489032685
1999 0.027544662523820984
2499 0.02454030788261396
2999 0.01883289422806623
3499 0.015966129543422993
3999 0.01346336538451275
4499 0.008211637550135972
4999 0.004168400301328305
5499 0.002861152901053209
5999 0.002148471355688253
6499 0.0016391422117425726
6999 0.0012603079317693774
7499 0.0010119188302159033
7999 0.0008375657759298641
8499 0.0007156548786497773
8999 0.0006314462618038756
9499 0.0005685116818783471
9999 0.0005134273900135653
CPU times: user 50.1 s, sys: 9.8 s, total: 59.9 s
Wall time: 7.76 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">get_model_error</span><span class="p">(</span><span class="n">model_nn_he</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model loss: 
 loss_u = 0.21186591749405562 
 loss_v = 0.337094501740013 
 loss_dens = 1.1886924241876031
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">delta_T</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">delta_X</span> <span class="o">=</span> <span class="mf">0.01</span>
    
<span class="n">n_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_dom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delta_X</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">n_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_dom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delta_T</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">inference</span><span class="p">(</span><span class="n">model_nn_he</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">n_x</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="s1">&#39;high_nn&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 finished
1 finished
2 finished
</pre></div>
</div>
<img alt="../../_images/7a7cb269eaab9d6fdb12bc55ddac9164f692394fc860b1dc2719b32d0f26edf5.png" src="../../_images/7a7cb269eaab9d6fdb12bc55ddac9164f692394fc860b1dc2719b32d0f26edf5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mse: u: 0.2118659174940555, v:0.33709450174001304
</pre></div>
</div>
</div>
</div>
<p>This does not capture any detail beyond the domain, as seen in Abs Err plots. Now for PINNs:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">omega</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">x_dom</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">L</span><span class="p">,</span><span class="n">L</span><span class="p">]</span>
<span class="n">t_dom</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">L</span><span class="p">]</span>
<span class="n">delta_x</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">delta_t</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">analytical_solution_function</span> <span class="o">=</span> <span class="n">get_analytical_solution_1_3</span>
<span class="n">x_physics</span><span class="p">,</span> <span class="n">t_physics</span><span class="p">,</span> <span class="n">f_colloc</span><span class="p">,</span> <span class="n">b_colloc</span><span class="p">,</span> <span class="n">ic_colloc</span><span class="p">,</span> <span class="n">ic</span> <span class="o">=</span> <span class="n">get_physics_colloc_points</span><span class="p">(</span><span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">delta_x</span><span class="p">,</span> <span class="n">delta_t</span><span class="p">,</span> <span class="n">analytical_solution_function</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">314</span><span class="p">)</span>
<span class="n">activation</span> <span class="o">=</span>  <span class="n">nn</span><span class="o">.</span><span class="n">Tanh</span><span class="p">()</span>

<span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">model_pinn_he</span> <span class="o">=</span> <span class="n">NN</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">activation</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_pinn_he</span><span class="p">,</span> <span class="n">loss_pinn</span> <span class="o">=</span> <span class="n">train_pinn</span><span class="p">(</span><span class="n">model_pinn_he</span><span class="p">,</span> <span class="n">n_epochs</span><span class="p">,</span> <span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">x_physics</span><span class="p">,</span> <span class="n">t_physics</span><span class="p">,</span> <span class="n">f_colloc</span><span class="p">,</span> <span class="n">b_colloc</span><span class="p">,</span> <span class="n">ic_colloc</span><span class="p">,</span> <span class="n">ic</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 	 Loss 	 PDE Loss
499 0.034803315397587825 1.1667250222004513
999 0.030816239251446303 0.892797702973085
1499 0.02898433086983385 0.8024795782817108
1999 0.02725238837113853 0.6911578046300655
2499 0.023496802156767044 0.6376621529324935
2999 0.01785216152448554 0.7411634771480853
3499 0.01463447300759326 0.8827789913655322
3999 0.011158598100972996 0.9597367131439621
4499 0.005115866649541363 1.1235537627506296
4999 0.0032234724772463503 1.1962402635031897
5499 0.0023450706079219535 1.1992541127715377
5999 0.0018094441197075322 1.0795630597511812
6499 0.0014278926536830082 0.9309726743353068
6999 0.0011448157141342621 0.8065568939649282
7499 0.0009412202058604413 0.7363376590987324
7999 0.0007830939508753171 0.6778500614880502
8499 0.0006669308950099964 0.6088177919967184
8999 0.0005860917440631878 0.5667642032426455
9499 0.0005240070592658164 0.5358619219047838
9999 0.0006053468956952364 0.5066755423420649
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">get_model_error</span><span class="p">(</span><span class="n">model_pinn_he</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model loss: 
 loss_u = 0.06425666320760758 
 loss_v = 0.039329193917649226 
 loss_dens = 0.013390438650537394
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">delta_T</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">delta_X</span> <span class="o">=</span> <span class="mf">0.01</span>
    
<span class="n">n_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_dom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delta_X</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">n_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t_dom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_dom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delta_T</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">get_data_set</span><span class="p">(</span><span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">delta_X</span><span class="p">,</span> <span class="n">delta_T</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">get_analytical_solution_1_3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inference</span><span class="p">(</span><span class="n">model_pinn_he</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">n_x</span><span class="p">,</span> <span class="n">n_t</span><span class="p">,</span> <span class="n">x_dom</span><span class="p">,</span> <span class="n">t_dom</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="s1">&#39;high_pinn&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 finished
1 finished
2 finished
</pre></div>
</div>
<img alt="../../_images/74a318f661491d95a367171614db476fedf78b180b93a458a38701fe67b04cd7.png" src="../../_images/74a318f661491d95a367171614db476fedf78b180b93a458a38701fe67b04cd7.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mse: u: 0.06425666320760758, v:0.039329193917649226
</pre></div>
</div>
</div>
</div>
<p>For higher energy states, it is difficult to capture the details with fully connected layers. PINNs can be extended with Recurrent Neural Networks to tackle this.</p>
</section>
<section id="span-style-color-orange-some-project-ideas-span">
<h2><span style="color:Orange">Some Project Ideas</span><a class="headerlink" href="#span-style-color-orange-some-project-ideas-span" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Experiment with different layer types for the higher energy states. One particular layer that might be useful would be gru layer (<a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.nn.GRU.html">https://pytorch.org/docs/stable/generated/torch.nn.GRU.html</a>). These layers are used for time series forecasting in Recurrent Neural Networks, which might be helpful for our time dependent system.</p></li>
<li><p>You can also use causal training loss for the higer energy states. The loss we have been using so far does not take causality into account. For a causal loss function, we divide the domain into consecutive time chunks and use a weighted sum of losses that enforces order in time. You can read more about it here:</p></li>
<li><p>Modify the PINNs to work with 2D QHO system
Hint: Since this is a separable system, we can extend it to 2D as follow:
$<span class="math notranslate nohighlight">\( \Large
\phi_n = \phi_n(x)\phi_n(y)
\)</span>$</p></li>
</ol>
<div class="math notranslate nohighlight">
\[ \Large
\hat{H} =\hat{H_x}+\hat{H_y}
\]</div>
<ol class="arabic simple" start="3">
<li><p>Can the neural network generalize over other parameters as well? Add <span class="math notranslate nohighlight">\(\omega\)</span> as an input to the neural network and train it to work with a range of <span class="math notranslate nohighlight">\(\omega\)</span> values.</p></li>
<li><p>Implement this network for other systems such as infinite square well.</p></li>
</ol>
</section>
<section id="span-style-color-orange-acknowledgments-span">
<h2><span style="color:Orange">Acknowledgments</span><a class="headerlink" href="#span-style-color-orange-acknowledgments-span" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Initial version: Mark Neubauer</p>
<ul>
<li><p>From APS GDS repository</p></li>
</ul>
</li>
</ul>
<p>© Copyright 2025</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./_sources/lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="PhysicsInformedNeuralNetworks.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Physics Informed Neural Networks</p>
      </div>
    </a>
    <a class="right-next"
       href="SymbolicRegression.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Introduction to Symbolic Regression</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-orange-helper-functions-span"><span style="color:Orange">Helper Functions</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-orange-brief-overview-span"><span style="color:Orange">Brief Overview</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-lightgreen-mathematical-formulation-span"><span style="color:LightGreen">Mathematical Formulation</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-lightgreen-physical-interpretation-span"><span style="color:LightGreen">Physical Interpretation</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-orange-infinite-square-well-span"><span style="color:Orange">Infinite Square Well</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-lightgreen-analytic-solution-span"><span style="color:LightGreen">Analytic Solution</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-lightgreen-setting-up-tise-solver-span"><span style="color:LightGreen">Setting up TISE Solver</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-orange-quantum-harmonic-oscillator-time-independent-span"><span style="color:Orange">Quantum Harmonic Oscillator (Time Independent)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"><span style="color:LightGreen">Analytic Solution</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-orange-quantum-harmonic-oscillator-time-dependent-span"><span style="color:Orange">Quantum Harmonic Oscillator (Time Dependent)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-lightgreen-base-case-span-psi-0-1-x-t"><span style="color:LightGreen">Base case:</span> <span class="math notranslate nohighlight">\(\psi_{0,1}(x,t)\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-lightgreen-fully-connected-neural-network-span"><span style="color:LightGreen">Fully Connected Neural Network</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-lightgreen-physics-informed-neural-network"><span style="color:LightGreen">Physics-Informed Neural Network</span></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-orange-training-considerations-span"><span style="color:Orange">Training Considerations</span></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-violet-architecture-span"><span style="color:Violet">Architecture</span></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-violet-collection-points-span"><span style="color:Violet">Collection Points</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-orange-higher-energy-states-span"><span style="color:Orange">Higher Energy States</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-orange-some-project-ideas-span"><span style="color:Orange">Some Project Ideas</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#span-style-color-orange-acknowledgments-span"><span style="color:Orange">Acknowledgments</span></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mark Neubauer
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>